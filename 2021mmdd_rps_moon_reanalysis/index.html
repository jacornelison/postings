<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Posting Title — J. Cornelison</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
	<script type="text/x-mathjax-config">
        MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript"
        src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>

<body>
<!-- Add my custom pager script -->
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

<header>
    <h1>RPS Analysis: Rederiving Mirror Parameters </h1>

    <time datetime="2020-xx-xx" class="published updated">
        2021 Mmm dd
    </time> —
    J. Cornelison
</header>

<hr>

<p>We found that the largest errors on absolute polarization angles estimated from the RPS analysis resulted from the mirror analysis. I did not perform moon observations during the Jan 2018 calibration campaign and so my RPS analysis involves using moon obervations and the RPS location from the previous year to derive the mirror parameters for 2018 which, if not handled properly, can easily propagate large errors into the final results. In this posting, I take a fresh look at the Jan 2017 moon data to acquire mirror parameters for 2018 with reduced systematic errors.</p>

<hr>


    <p>To summarize, we compare beam centroids from moon observations to estimate the mirror tilt, mirror roll, and drum angle. We then lock in these mirror and drum angle parameters and use beam centers from RPS data to estimate the location of the RPS. For the 2018 RPS data, no moon observations were taken so we estimate the location of the source from 2017 moon and (prelimenary) RPS observations and, assuming the RPS was placed at the same location the next year, we fit for the Jan 2018 mirror parameters using RPS data.</p>

<section><h2>Mirror Parameters 2017</h2>

    <p>In the previous attempt, we estimated the mirror tilt and roll parameters by fitting 2D Gaussians to detector timestreams in boresight-centered ($r/\theta$) coordinates returned by a pointing model <tt>keck_beam_map_pointing.m</tt> (described in <a href="CAB2014"></a>):</p>

    \begin{equation}
    [r,\,\,\theta] = \text{keck_beam_map_pointing}(Tilt,\,Roll\,|\, Az,\,El,\,Dk,\,Mount,\, Moon)
    \end{equation}


    where $Mount$ contains the relevant mount information derived from Solidworks drawings; $Moon$ containts the on-sky, per-timestream-sample location of the moon; and $Az$, $El$, and $Dk$ are converted from raw encoder vlaues to topocentric coordinates using starpointing. We converted $r/\theta$ into $x/y$ coordinates using Lambert azimuthal equal-area projection (see <a href="IDB2013"></a>)


    \begin{equation}
    x = 2 \sin(r/2) \cos(\theta)\\
    y = 2 \sin(r/2) \sin(\theta)
    \end{equation}

    and then fit the beams.

    <p>The datasets for the moon observations are huge so re-estimating beam centroids from 2D Gaussian models for each permutation of the roll-tilt-drumangle parameter space isn't computationally feasible. In the previous analysis, I mitigated this by only analyzing a few detectors at a single deck angle. Instead, I take the Az/El/Dk position at the max amplitude of the timestream as the beam centroid. This drastically reduces computation time of the fit which allows me to quickly fit all of the available detectors across all three datasets at the expense of increased uncertainty of the beam centroids<sup>[<a name="sup1" href="#ftn1">1</a>]</sup>.</p>

    <p>So Eq. 1 becomes</p>
    \begin{equation}
    [r_{0},\,\,\theta_{0}] = \text{keck_beam_map_pointing}(Tilt,\,Roll,\, DA\,|\, Az_0,\,El_0,\,Dk_0,\,Mount,\, Moon)
    \end{equation}

    where $Az_0$, $El_0$, and $Dk_0$ are the per-detector positions at max amplitude; $r_{0}$ and $theta_{0}$ are the beam centers (converted to $x_0/y_0$ using Eq. 2); and $DA$ is a new 'drum angle' parameter that accounts for any discrepancies in the CMB-derived drum angle of 1.5&deg; <a href="RWO2015"></a>.
    <p>Then using CMB-derived beam centers as the 'observed' quantity, the chi-square to minimize is just:</p>

    \begin{equation}
    \chi^2=\sum \frac{(x_{CMB,i}-x_{0,i})^2+(y_{CMB,i}-y_{0,i})^2}{\sigma_i^2}
    \end{equation}

    <p>
        which is done using our Matlab wrapper of <i>MINUIT</i> called <tt>matmin.m</tt>. I estimate the statistical uncertainty using bootstrapping.
    </p>


    <h3>Results</h3>
    <table class="center">

        <tr>
            <th>Parameter</th>
            <th>Best-Fit $(^\circ)$</th>
            <th>Bootstrap $\mu\,(^\circ)$</th>
            <th>Bootstrap $\sigma\,(^\circ)$</th>
        </tr>
        <tr>
            <td>Tilt</td>
            <td>44.5473</td>
            <td>44.5472</td>
            <td>0.0004</td>

        </tr>
        <tr>
            <td>Roll</td>
            <td>-0.9651</td>
            <td>-0.9651</td>
            <td>0.0006</td>
        </tr>
        <tr>
            <td>DA</td>
            <td>0.291</td>
            <td>0.291</td>
            <td>0.006</td>
        </tr>
    </table>


    <!--
    Things to think about:
    1. Where do 'observed' r/th's come from?
        - CMB-derived centers

    2. How different are the residuals between max-amp centers and beam-fit centers?

    3. Why doesn't changing the theta of the 'boresight' affect calculation of x/y?
        A. x/y is defined by the orientation vector and aligned wrt the mount (dk) and not focal plane (dk+da)
        B. theta (which includes drum angle) only determines the location of D, not the orientation vector.

    4. What does a non-zero dk_off mean in the fit?
        - .
    -->

    <p>We find a difference between the apparent drum angle and the CMB-derived drum angle of -1.21&deg;. The plot below shows the best-fit residuals when the drum angle is locked at the CMB-derived value and when it is allowed as a free parameter.</p>

    <figure>
        <img src="figs/moonfit_residuals_no_drumangle.png" />
        <figcaption>
            Best fit residuals with cmb-derived drum angle locked in <b>(left)</b>, left as a free parameter <b>(middle)</b>, and the difference between the two sets of residuals <b>(right)</b>.
        </figcaption>
    </figure>


    <h3>Data</h3>
    <h4>Moon Observations</h4>
    <figure>
        <table>
            <tr>
                <th>Schedule</th>
                <th>Start</th>
                <th>End</th>
                <th>DK</th>
            </tr>
            <tr>
                <td>8_ffflat_moonraster_28_dk000_001.sch</td>
                <td>170121 22:29:58</td>
                <td>170121 23:25:36</td>
                <td>0</td>
            </tr>
            <tr>
                <td>8_ffflat_moonraster_28_dk045_001.sch</td>
                <td>170121 23:26:36</td>
                <td>170122 00:20:45</td>
                <td>45</td>
            </tr>
            <tr>
                <td>8_ffflat_moonraster_28_dk090_001.sch</td>
                <td>170122 00:36:46</td>
                <td>170122 01:31:05</td>
                <td>90</td>
            </tr>

        </table>

    </figure>

    <figure>
        <img src="figs/moon_coverage_2017.png" />
        <figcaption>
            Focal plane coverage of the three 2017 moon observations used for this analysis. Topocentric coordinates were converted into x/y coordinates using best-fit mirror tilt, roll and drum angle parameters.
        </figcaption>
    </figure>

    <h4>Ephemeris Data</h4>

    <p>Ephemeris data was acquired from <a href="https://ssd.jpl.nasa.gov/horizons.cgi">JPL Horizons</a> using the following settings:</p>

    <pre>
    Ephemeris Type : 	OBSERVER
    Target Body :       Moon [Luna] [301]
    Observer Location : MAPO (South Pole) [-97] ( 314°12'36.7''E, 89°59'35.4''S, 2997.29 m )
    Time Span :         Start=YYYY-MM-DD, Stop=YYYY-MM-DD, Step=1 m
    Table Settings :    QUANTITIES=4,20; date/time format=JD; time digits=SECONDS; angle format=DEG; range units=KM;
                        elevation cutoff=0; suppress range-rate=YES; CSV format=YES; object page=NO
    Display/Output : 	download/save (plain text file)
    </pre>

    <p>The minimum timestep from JPL Horizons is 1 minute so moon positions are interpolated down to the sampling of the timestreams during analysis.</p>

    <h4>Absolute Beam Centers</h4>
    <p>This analysis uses the <tt>beamcen_20170101</tt> CMB-derived beam centers which is discussed in <a href="JBW2018"></a>. It should be noted that the $r/\theta$ values returned by <tt>get_array_info.m</tt> include an additional rotation from the drum angle. To remain agnostic of the drum angle for this analysis, we acquire the CMB-derived beam centers using <tt>find_file_by_date.m</tt> instead.
    </p>

</section>

<section>
    <h2>Source Parameters 2017</h2>

    <h3>Results</h3>

    <h3>Data</h3>

</section>

<section>
    <h2>Mirror Parameters 2018</h2>

    <h3>Results</h3>

    <h3>Data</h3>

</section>

<hr>

<section>

    <h3>Notes</h3>
    <div class="footnote"><p>
        <sup>[<a name="ftn1" href="#sup1">1</a>]</sup>
        Using the max amplitude impinges an uncertainty on the beam centers which is half of the sample spacing for a given coordinate. In instrument-fixed coordinates, this corresponds to a median beam center uncertainty of $\sigma\sim0.05^\circ$ which is comparable to the quoted errors on the CMB-derived beam centers (median $\sigma\sim0.01^\circ$).

    <h3>Code</h3>

<ul>
<li><tt>code1.py</tt> - Code desciption
</ul>


<h3>References</h3>
<p id="references"></p>
	<script type="text/javascript">
	// This my way of making shorthand links.
	// We'll make a couple arrays with the 'tag' and href information
	// and then look through each anchor element for the specified tag.
	// The anchors should then just look like: <a href="tagname"></a>
	// and the script will automatically fill in the hyperlings and text.
	var tags = [
        "CAB2012",
        "IDB2013",
        "CAB2014",
        "RWO2015",
        "JBW2018",
	];
	
	// Logbook Site map:
    // bkcmb:   www/bkcmb/analysis_logbook/analysis/
    // keck:    www/keck/analysis_logbook/analysis/
    // BICEP3:  www/bicep3/analysis_logbook/
    // BA:      www/bicep_array/analysis_logbook/
	
	var hrefs = [
        "../../../../keck/analysis_logbook/analysis/20120510_beam_map_pointing/",
        "../20131005_sidelobe_coordinates/sidelobe_coordinates.pdf",
        "../../../../keck/analysis_logbook/analysis/20140203_beam_map_pointing/",
        "http://polar-array.stanford.edu/twiki/bin/view/BICEP3/Logbook150205RadioPointing",
        "../20181207_B2018_beamcen/",
	];
	
	var desc = [
        "Pointing Model for Keck Beam Maps",
        "Calculations for Beam Mapping in Spherical Coordinates",
        "Spherical Coordinates for beam maps",
        "Radio pointing model from CMB",
        "B2016, B2017, and B2018 CMB-derived beam center correlations",
	];
	
	
	var post = document.getElementById("references");
	var msg = "<table>";
	for (var tag in tags){
		msg = msg + "<tr><td><a href="+hrefs[tag]+">"+tags[tag]+"</a></td><td> - </td><td>"+desc[tag]+"</td>";
	};
	msg = msg+ "</table>";
	post.innerHTML = msg;

	var links = document.getElementsByTagName("A");
	for (var link in links){
		for (var tag in tags){
			if (links[link].href.endsWith(tags[tag])){
				links[link].text = "("+tags[tag]+")";
				links[link].href = hrefs[tag];
				links[link].target = "_blank";
			}
		}
	}
	
	</script>
</section>
</body>
