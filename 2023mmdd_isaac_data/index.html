<!DOCTYPE html>

<!--suppress HtmlDeprecatedAttribute -->
<head>
    <meta charset="utf-8">
    <title>In-Lab ISAAC Measurements</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript"
            src="../mathjax/MathJax.js?config=TeX-AMS-MML_SVG">
            // src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

</head>

<body>
<!-- Add my custom pager script -->
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

<header>
    <h1>In-Lab Angle Measurements using the RPS and ISAAC</h1>

    <time datetime="2022-02-14" class="published updated">
        2023 mmm dd
    </time> â€”
    J. Cornelison
</header>

<hr>

<p>
    This goes over the set up of the angle measurements between the ISAAC and RPS both at Pole and here at Harvard. Currently, I can derive the angle of the ISAAC's polarization angle WRT gravity with an accuracy of ~<0.2&deg;. I don't yet fully understand the limitations of this measurement, my current hypothesis is that, at these short distances of &le;1m, the measurement is more sensitive to the alignment of the experimental set up that I have so far been able to achieve.
</p>

<hr>

<section><h2>Experimental Set Up</h2>

    <p>Summary:</p>
    <ul>
        <li>The wire grid angles WRT to their reference surfaces are measured for both the RPS and ISAAC in the knee mill.</li>
        <li>The tilt meters for both the RPS and ISAAC are then calibrated using a Starrett No.96 bubble level.</li>
        <li>The RPS and ISAAC are placed at some distance apart facing each other.</li>
        <li>The RPS rotates from -180&deg; to 180&deg; usually in 30&deg; increments.</li>
        <li>At each commanded angle, the RPS waits 2 seconds before moving to the next angle.</li>
        <li>Unlike the measurements on B3, we don't take beam maps with the ISAAC. It is fixed in one position for the duration of the measurement.</li>
        <li>The RPS is chopped at 1KHz and the ISAAC is readout by the Lock-In amplifier via pac-mil detector diode. The phase between the reference and ISAAC is zeroed through the lock-in.</li>
        <li>The data are recorded via labjack using my raspberry pi. I also record the tilt outputs from both the RPS and ISAAC.</li>
        <li>Each measurement comprises 13 sets of 2-second timestreams per command angle. I average over each 2-second timestream to create a modulation curve.</li>
        <li>For a single run, I repeat the measurement 25 times.</li>
        <li>I fit angles to each of the 25 modulation curves.</li>
    </ul>

    <p>
        The angle between the RPS's electric field and gravity at a given command angle, $\zeta_{comm}$, is given by:
    </p>
    $$
    \zeta_{grav,RPS} = \zeta_{comm}-\zeta_{grid,RPS}+\zeta_{tilt,RPS}
    $$

    <p>where $\zeta_{grid}$ is the command angle at which the RPS's wire grid is horizontal with its reference surface
        and $\zeta_{tilt,RPS}$ is the calibrated readout of the tilt meter.</p>
    <p>I define the angle $\phi$ which is the angle measured from the vector that defines "up" WRT gravity to the vector defining the ISAAC's electric field</p>
    <p>I estimate $\phi$ using our typical model for a modulation curve: </p>

    \begin{equation}
    A = G\left[\cos(2(\zeta_{grav,RPS}+\phi))-\frac{\epsilon+1}{\epsilon-1}\right]\left(N_1 \cos(\zeta_{grav,RPS}) + N_2 \sin(\zeta_{grav,RPS}) + 1\right)
    \end{equation}





    <p>The ISAAC's tilt meter is installed in the same configuration as the RPS -- the angle between the ISAAC's electric field WRT to gravity (in the same coordinate system) is</p>

    $$
    \phi_{actual} = \zeta_{grid,ISAAC}-\zeta_{tilt,ISAAC}
    $$


<p>
    The idea here is that, if we've got everything right, then the $\phi$ we fit from the modulation curves should be equal to $\phi_{actual}$ to within uncertainty.
</p>

    <hr>

    <p>
        The figure below shows the results of the RPS-ISAAC measurements done at Pole before the campaign, before we installed the fine homing switch; after we installed the fine homing switch; after I brought the RPS down; and then when I measured the RPS in the jig at Harvard. The blue dots are distributions of $\phi-\phi_{actual}$, where the dot is the mean and the error bars are the 1&sigma; STD. The angle fit from the modulation curves should be the same as $\phi_{actual}$ within uncertainty. So in the figure, we're expecting all of the blue data points to overlap with zero. I show the tilt of the RPS and the tilt of the ISAAC to show I'm accounting for them correctly.
    </p>

    <p>
        At Pole, I used the Starrett bubble level to level the RPS and ISAAC before the measurements. At Harvard, I purposefully didn't level them until later to verify that they tilts could properly be accounted for.
    </p>

    <figure>

        <img src="figs/angle_fit_vs_actual_plot.png"/>
        <figcaption>
            <p>Summary plot of the RPS-ISAAC measurements at Pole and at Harvard. Each blue dot is the mean/std of the
                angles estimated from modulation curves minus the actual angle expected of the ISAAC from the tilt/grid
                info. Yellow x's are the mean ISAAC tilt angle from a given modulation curve within a dataset. The red
                dots are the mean RPS tilt angle from a given modulation curve within a dataset.</p>
            <p>
                Salient information for these data are outlined the section below.
            </p>
        </figcaption>
    </figure>

    <p>
        Notes on the Pole Measurements
        <ul>
        <li>Before installing the fine homing switch:
            <ul>
                <li>
                    <b><tt>Outdoor, Homed Once:</tt></b> We found very good repeatability when not homing between measurements, even outside. At this time, I was ignoring the fact that the means were non-zero.
                </li>
                <li>
                    <b><tt>Outdoor, Homed Each:</tt></b> When homing each measurement, the homing repeatability got significantly worse.
                </li>
                <li>
                    <b><tt>Indoor, Homed Each:</tt></b> When brought back inside, the homing repeatability appeared to improve.
                </li>
                <li>The measurements here eventually led us to retrofitting the rotation stage with a fine homing switch. For more details on those initial measurements see <a href="JAC2021"></a> and a collection of the emails exchanged during that time curated by Clara (<a href="https://docs.google.com/document/d/1dewXjLoCzYZSDZdeKzdBJFfFibG-s4vx7ZVfwHjYttc/edit#">RPS Obs Troubleshooting Emails</a>).</li>
                <li>
                    In addition to the new homing switch, there were a few more notable changes between this set of measurements and the next set:
                    <ul>
                        <li>We installed a dial on the stepper knob</li>
                        <li>We installed an additional heater, bolted directly to one side of the rotation stage.</li>
                        <li>The gears in the rotation stage were degreased and re-greased with low-temp aviation grease.</li>
                    </ul>
                </li>
            </ul>
        </li>
        <li>
            After installing the fine homing switch:
            <ul>
                <li>
                    For all of these datasets, I homed between every measurement. I also ensured the ISAAC and RPS were level WRT gravity using the Starrett bubble level. I realize I should've taken some measurements without homing, but I hadn't thought to do so at the time, it seems.
                </li>
                <li>
                    <b><tt>Indoor, Pre-Obs: </tt></b>The two indoor tests showed reasonable repeatability with means around zero. The setup was unchanged between the two measurements. I also verified that I could not detect any backlash by sight or feel.
                </li>
                <li><b><tt>Outdoor, Pre-Obs</tt></b>: Before starting the RPS campaign, I performed one last rooftop measurement. The repeatability was still reasonable, but the mean is off by ~-0.1&deg;. My notes show that the knob angle was unchanged throughout this measurement.
                    <ul>
                        <li><b>A mystery:</b> My notes state that the mean for this measurement was consistent with zero, but this is obviously not the case now. I recall in the last day that I was at Pole, I discovered an issue with the chi-square minimizer I was using, <tt>fminsearch</tt>, had a bug where it would return values close to the initial guess regardless of what the actual angle was. I recall replacing <tt>fminsearch</tt> with another minimizer <tt>lsqcurvefit</tt> resolved this issue. However, I have so far been unable to reproduce my previous results by going back and using <tt>fminsearch</tt>-- but I've since upgraded my matlab so perhaps this has been fixed. Hard say exactly what happened here.</li>
                    </ul>
                </li>
                <li>
                    <b><tt>Outdoor, Post-Obs:</tt></b> When I brought the RPS down, I took 1 outdoor measurement and 3 indoor measurements. My notes are limited here, but I recall verifying that the knob angle was unchanged from before we raised the mast.
                </li>
                <li>
                    <b><tt>Indoor, Post-Obs: </tt></b>
                    <ul>
                        <li>When bringing the RPS back inside, I verified that I was unable to detect any backlash by sight or feel.</li>
                        <li>The set up for the three indoor measurements were more or less the same except either the RPS or ISAAC was picked up and put back down between taking each measurement set. The distance between the RPS and ISAAC for each measurement was ~1m, I aligned the pointing by eye, and I ensured they were level using the Starrett bubble level.</li>
                        <li>An important bit of information here is that I had developed a worry that uneven heating of the rotation stage from the extra heater we installed on it might induce a rotation of the grid not captured by the tilt meter. The first of indoor measurements I took occurred while the RPS and ISAAC were still warming up. For the second indoor measurement, I had allowed the RPS to warm up to room temp, but brought the ISAAC back outside and took another measurement while it was still cold. For the third measurement, I did the opposite: while the ISAAC warmed up, I placed the RPS outside and let it cool down, taking another measurement while the stage was still relatively cold. I realized since then that the &Delta;T required for a rotation of ~0.2&deg; I saw is $\frac{tan(\Delta\theta)}{CTE}=\frac{tan(0.2)}{23\times 10^{-6}}=150K$ where the CTE is aluminum -- not at all realistic -- so what I effectively did was change the alignment from measurement-to-measurement.</li>
                    </ul>
                </li>

            </ul>
        </li>
        </ul>
    </p>

    <p>Notes on the in-lab measurements at Harvard.
    <ul>
        <li>I verified in the RX-lab's Bridgeport that the RPS and ISAAC grid angles were unchanged from the measurements I took in Late December 2021. I did however measure backlash of +0.06&deg; in the rotation stage in March 2023. I verified in October 2023 that the 0.06&deg; backlash was unchanged.</li>

        <li>I created an alignment jig here in the lab that allowed me repeat alignment between the RPS/ISAAC to within a few millimeters (see the figure below).
            The RPS and ISAAC are both capable of up-down (X)/left-right (Y)/ forward-back (Z) translation.
            I also fixed the ISAAC to the spare rotation stage so that I could adjust the azimuthal pointing of the ISAAC more precisely.</li>

        <li>Most of these measurements took place in late July 2023.</li>

        <li><b>Initital Alignment:</b> I placed RPS and ISAAC at distance of ~1cm away from each other. I then adjusted the X/Y translation of the ISAAC such that the wire grids which are the same diameter were concentric to within a few millimeters. I minimized the aligment of the two in elevation by leveling them in the Z-direction with a rough bubble level (level within a few degrees). I minimized the azimuthal alignment of the ISAAC by eye by adjusting the spare rotation stage by eye so that the ISAAC was square with the RPS rotation stage.</li>

        <li>I took measurements at two distances, 0.5m and 1m.</li>

        <li>For the first portion of the data, I took them without homing between each measurement (i.e. I collected 25 modulation curves before homing again). For the second portion, I homed between each modulation curve I collected. We can see that there's virtually no difference between homing and no homing.</li>

        <li>For most of the data I collected in the lab, I purposefully didn't level the RPS or ISAAC. However, I did at some point change the tilt of both the RPS and ISAAC to show that angle we get out was unchanged and we are thus accounting for the tilts properly.</li>
        <li>
            For the last few measurements, I offset the ISAAC by a couple centimeters to examine the effect.
        </li>
        <li>
          For the very last measurement set I collected, I added a bunch of eccosorb around the jig to try and mitigate reflections and saw no significant change.
        </li>
    </ul>

    </p>

    <figure>
        <img src="figs/rps_isaac_jig.jpg" width="100%">
        <figcaption>
            Set up of the RPS-ISAAC measurements on the jig at Harvard.
        </figcaption>
    </figure>


    <h3>My Conclusions so far</h3>
    <p>
        Any minor change to the apparatus results in a significant, repeatable offset to the angle we estimate from the modulation curves.
        I was able to show that I'm accounting for the tilts correctly and after adding eccosorb to the jig set up and seeing no changes, I think we have evidence that multipath effects are also not a significant contributor.
        I've tried testing the hypothesis that the measurement at this distance is limited by the alignment by simulating mod curves with a complex pointing geometry, but my current model doesn't create any offsets at this level.
    </p>
    <p>
        At any rate, if it <i>is</i> an alignment issue, at least in terms of linear translation, we expect the effect to decrease as a function of distance and, with the RPS a distance of 200m during normal observation, I expect any bias we see as a result of transformation offsets to be negligible.
        For azimuthal or elevation misaligment, however, that isn't necessarily true. Fortunately, the tags on the side of the RPS box ensures that azimuthal misalignment keeps us to <0.5&deg;. For elevation, I admittedly don't have nearly as strong of a prior.
    </p>

    <h3>Can we check for evidence of backlash on BICEP3 obs through homing measurements?</h3>
<p>
    Another interesting note is the no-homing vs. homing distributions for the at-Harvard measurements. Specifically, that there's virtually no difference between the two whereas it was very obvious when we weren't homing in earlier measurements. I can imagine a scenario where, at command angles where the rotational torque on the RPS is sufficiently small, what side of the backlash the source falls on is somewhat randomized and that will result in an increased uncertainty whether or not we're homing.
</p>
   <p>
        A test we could do to confirm this would be to fix the backlash (or add more of it) and take some more measurements with and without homing. This of course would mean losing the original grid calibration, but I don't think we actually need it anymore.
    </p>

    <p>
        If the argument above is correct, then we can compare distributions of pol angles on BICEP3 with and without homing to check for evidence of backlash occurring during the campaign.
        On the last day of the campaign, I took a number of diagnostic measurements, including a set of 10 Type 9 observations that did not home between rasterset.
        If backlash developed sometime during the campaign, we should expect to see no difference between the Type 9 observations that homed before every measurement and this dataset without homing.
        In the plot below, I show histograms of both the Pol-0 and Pol-90 detectors with- and without homing. We can see that the distribution without homing is roughly 20% smaller than when we are homing.
    </p>
<p>
    This isn't very strong evidence because we expect from our first ISAAC measurements that we were able to get down to a precision of ~0.01&deg; when not homing. However, I find it plausible that the non-homing $\sigma_\phi$ could be lower, but we're simply running up against the intrinsic statistical limit of the measurement on BICEP3.
</p>


    <figure>
        <img src="figs/type9_homing_hists.png" width="70%">
        <figcaption>

        </figcaption>
    </figure>

    <h3>Why isn't the homing repeatability affected by backlash?</h3>
    <p>
        We can also see that the means on the distributions are consistent to 0.01&deg;, so it appears the homing repeatability is unaffected by the backlash. In the hypothesis that the backlash is unconstrained (i.e. not directionally driven), this means that when the RPS is around the homing switch, the rotational torque must always be in the same direction, forcing the stage to consistently be on one side of the backlash. Looking at the RPS in Fig 1.2 above (which was commanded to 0&deg;), we can see at angles near zero that the torque on the stage is strongly in the counterclockwise direction (looking toward the front of the RPS) due to the uneven weight distribution of the BSNS, which supports my hypothesis.
    </p>


</section>

<hr>

<section class="appendix">

<h2 class="appendix">Appendix</h2>

    <h3>To-Do: Show the mod curve residuals.</h3>

    <h3>Footnotes</h3>
    <p>Click on the number to return to the main text.</p>
    <div class="footnote">
        <p>
        <sup><a name="ftn1" href="#sup1">[1]</a></sup>

    </p>
    </div>
<!--    <h3>Code</h3>-->
<!--    <p>Below is a list of code that was used for this analysis. The code is committed to the pipeline and can be found in the <tt>analysis/beammap/</tt> directory.</p>-->
<!--    <p id="code"></p>-->

<!--    <h3>Data</h3>-->
<!--    <p id="data"></p>-->
    <h3>References</h3>

    <p id="references"></p>


    <p id="testp"></p>



    <script type="text/javascript">

        // Shorthand tags
        var codes = [
            "rps_fit_mirror_from_moon.m",
            ];

        // Posting titles
        var desc = [
            "Derives mirror parameters from observations of the moon.",
        ];

        // Make a list of references
        var post = document.getElementById("code");
        var msg = "<table class=\"code\">";
        for (var code in codes){
            msg = msg + "<tr><td><tt>"+codes[code]+"</tt></td><td> - </td><td>"+desc[code]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

    </script>

    <script type="text/javascript">

        // Shorthand tags
        var data = [
            "moonsch.mat",
            ];

        // Posting titles
        var desc = [
            "Metadata of Moon observations",
            ];

        // Make a list of references
        var post = document.getElementById("data");
        var msg = "<table class=\"code\">";
        for (var datum in data) {
            msg = msg + "<tr><td><tt>" + data[datum] + "</tt></td><td> - </td><td>" + desc[datum] + "</td>";
        }
        ;
        msg = msg + "</table>";
        post.innerHTML = msg;

    </script>



    <script type="text/javascript">

        // This my way of making shorthand links.
        // We'll make a couple arrays with the 'tag' and href information
        // and then look through each anchor element for the specified tag.
        // The anchors should then just look like: <a href="tagname"></a>
        // and the script will automatically fill in the hyperlings and text.


        var posting_dir = window.location.href; // What's the current url?

        var bkurl = "bicep.rc.fas.harvard.edu";
        var spurl = "bicep.usap.gov";

        // These are the possible places to find postings
        // The strings are for if you post your posting in that directory.
        var sitemap = {
            jcornelison: "../../../",   // /jcornelison/postings/
            bkcmb : "../../../../",     // /bkcmb/analysis_logbook/analysis/
            bicep3: "../../../",        //
            bicep_array: "../../../",   //
            bicep2: "",                 // We shouldn't be posting in these, but still have postings we can reference.
            keck  : "",                 // keck/analysis_logbook/analysis/
            spuder: "",                 // ~spuder/hieno_analysis_logboo
            bicep1: "",                 // ~bicep1/analysis_logbook_north/
            general_projects:"",
                   };
        // Logbook Site map:
        // personal:www/jcornelison/postings/
        // bkcmb:   www/bkcmb/analysis_logbook/analysis/
        // keck:    www/keck/analysis_logbook/analysis/
        // BICEP3:  www/bicep3/analysis_logbook/
        // BA:      www/bicep_array/analysis_logbook/
        // We shouldn't be posting in these, but still have postings.
        // bicep2:
        // keck:    www/keck/analysis_logbook/analysis/
        // spuder:  www/~spuder/hieno_analysis_logbook/
        // bicep1:  www/~bicep1/analysis_logbook_north/

        // Shorthand tags
        var tags = [
            "JAC2021",
        ];

        // Links
        // Truncate the link down to the www directory in which it lies if you can.
        // This ensures that we can view the linked postings at Pole without the internet.
        var hrefs = [
            "jcornelison/postings/2021mmdd_isaac_test/",
        ];


        // Posting titles
        var desc = [
            "In-Situ Angle Calibrator (ISAAC)",
        ];
        // Debug



        var preface = "";
        var keys = Object.keys(sitemap);
        // If we're not at pole or bicep, just post the full URL
        // If we are, go back to the www directory.
        if (posting_dir.match(new RegExp(bkurl))!=bkurl &
            posting_dir.match(new RegExp(spurl))!=spurl){
                preface = "http://" + bkurl+"/";
            }
        else {
            for (key in keys){
                if (posting_dir.match(new RegExp("/"+keys[key]+"/"))=="/"+keys[key]+"/"){
                    preface = sitemap[keys[key]];
                };
            };

        };

        // Add the prefixes we can.
        // Only add prefixes to directories in the sitemap so we don't break
        // external references.
        for (ref in hrefs) {
            for (key in keys) {

            // If there's a match, at the prefix and move on.
            if(hrefs[ref].match(new RegExp(keys[key] + "/"))==keys[key]+"/"){
                hrefs[ref] = preface+hrefs[ref];
                break;
            }
            };
        };

        // posty.innerHTML = preface;

        // Make a list of references
        var post = document.getElementById("references");
        var msg = "<table>";
        for (var tag in tags){
            msg = msg + "<tr><td><a href="+tags[tag]+"></a></td><td> - </td><td>"+desc[tag]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

        // Look through all the hyperlinks and insert the proper links to the postings
        var links = document.getElementsByTagName("A");
        for (var link in links){
            for (var tag in tags){
                if (links[link].href.endsWith(tags[tag])){
                    links[link].text = "("+tags[tag]+")";
                    links[link].href = hrefs[tag];
                    links[link].target = "_blank";
                }
            }
        }

    </script>
</section>




</body>
