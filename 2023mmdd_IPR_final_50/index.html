<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <title>IPR Final Pager with 50 realizations</title>
  <!--link rel="stylesheet" type="text/css" href="style.css"-->
  <!-- Load up MathJax for math notation
       Note that for local testing, the http: needs to be prepended.
       Before publishing to the web server, restore the SSL-agnostic
       version by ensuring the address starts with just //
  -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }
    });
  </script>
  <script type="text/javascript"
      src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
</head>

<body>
<!-- Include the group's standard pager -->
<script src="pager.js"></script>

<header>
  <h1>Isotropic Polarization Rotation Analysis #: Final Pager with 50 Sims (blinded) (draft)</h1>

  <time datetime="2023-xx-xx" class="published updated">
    2023 Mmm dd
  </time> —
  James Cornelison
</header>

<hr>

<p>
  Notes:
  <ul>
  <li>The two simsets we'll be using for the birefringence results are 2017+2018 coadds called "Legacy" and "Reanalysis". For comparison, I've included a "BK" click which is the 2-year coadd jacks of the sims/real used in BK18.</li>
  <li>In addition to regular final plots, I show an additional figure of angle fits to the jack EB spectra. Angles for a given jack are fit in two ways:</li>
  <ul>
    <li>angle (EE/BB Jack #) -- Uses the jack's EE/BB spectra as the input model to the estimator.</li>
    <ul><li>This looks for leakage signals in the jacks itself that might've rotated into EB.</li></ul>
    <li>angle (EE/BB Jack 0) -- Uses Type 8 Jack0 EE/BB spectra as the input model to the estimator.</li>
    <ul><li>This looks for excess signal in the Jack EB that might resemble rotation of CMB EE.</li></ul>
    <li>The spectra used to do the fits are shown along with the angle histograms.</li>
  </ul>
  <li>Jacks are debiased.</li>
  <li>Jacks show real data.</li>
  <li>I still need to make the PTE tables.</li>
</ul>
</p>

<!--<p>This is the B2019/20 final pager with the complete set of 499 sims. This posting is a followup to <a href="../20211020_B201920_final_99/">B2019/20 first 99 realizations final pager.</a></li> and should be viewed along with the <a href="../20210924_B2019_B2020_mapspager/">B2019/20 maps pager</a>. -->


<!--<hr>-->

<!--<section><h2>Final pager</h2>-->
<!--  <p>Things to remember:</p>-->
<!--<ol>-->
<!--<li>-->
<!--	No polarization angle rotation has been applied.-->
<!--</li>-->
<!--<li>-->
<!--	No matrix.-->
<!--</li>-->
<!--<li>The figures for B2016/2017/2018 clicks are taken from <a href="../20201012_B18_3553_final/">B2016,2017,2018 Final Pager without tile 1, 99sims (HH)</a></li>. -->
<!--</ol>-->
<!-- -->
<!--<p> The variability of the brightest point source in the field is significant in 2019, and it shouldn't be of any surprise that it has resulted in some BB PTE values which have been shown in this posting as jackknife outliers. We had seen a significant contamination in the 1st/2nd half weights jacknife in the <a href="../20210924_B2019_B2020_mapspager/">B32019/20 maps pager</a>, the point source in that case is much brighter than the nominal noise (see 1st/2nd half weights option for Q and U), hence the manifestation as jack outliers.  This particular contamination i.e., magnitude of the difference in polarization of the source in the 2 halfs is not significantly higher than the noise in 2020, so it doesn't result in a jack failure, but it is clearly at a level where it needs to be dealt with in the 2019 data before proceeding further. Jamie discusses the variability of the concerned point source at length in <a href='../20211019_b3_pntsrc_fluxes/'>this posting</a>. Other than the point source which results in a few outliers in BB jackknives in 2019, things look pretty good, atleast in the bandpowers 2-6. -->
<!--<p> I list only the jack outliers seen with the Kendrick pure-B estimator, for the polarization data, i.e., ones seen for EE, BB and EB. As we consider 14 jackknife measures in 2 ranges of bandpower (1-5, 1-9), 2 PTE (χ and χ²) for dp1102, there are a possible suite of 168 jackknife tests per band. Only 6/168 and 4/168 of those for B2019 and B2020 data lie marginally outside the nominal range of \(0.01 \leq \) PTEs \( \leq 0.99\).      -->
<!--<p><b>Low/High PTEs Summary</b>-->
<!--<ul>-->

<!--<li><b>2019</b>-->
<!--<table>-->
<!--<thead style="font-weight:bold;text-align:center;">-->
<!--  <tr>-->
<!--    <td>Bandpowers 1–5</td>-->
<!--    <td>Bandpowers 1–9</td>-->
<!--  </tr>-->
<!--</thead>-->
<!--<tbody style="vertical-align:text-top;">-->
<!--  <tr>-->
<!--    <td>-->
<!--      <ol>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'3', lmax:'200', figtype:'c3', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2019'});">BB tag split jackknife (χ²)</a> 0.008</li>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'e', lmax:'200', figtype:'c4', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2019'});">BB A/B offset, best/worst (χ)</a> - 0.008</li>-->
<!--    -->
<!--  </ol>-->
<!--    </td>-->
<!--    <td>-->
<!--	<ol>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'3', lmax:'500', figtype:'c3', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2019'});">BB tag split jackknife (χ²)</a> - 0.004 </li>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'3', lmax:'500', figtype:'c4', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2019'});">BB tag split jackknife (χ)</a> - 0.002* </li>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'2', lmax:'500', figtype:'c4', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2019'});">BB scan dir jackknife (χ)</a> - 0.996 </li>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'e', lmax:'500', figtype:'c4', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2019'});">BB A/B offset, best/worst (χ)</a> - 0.002*</li>-->



<!--	</ol>-->
<!--    </td>-->
<!--  </tr>-->
<!--<tbody>-->
<!--</table>-->

<!--<li><b>2020</b>-->
<!--<table>-->
<!--<thead style="font-weight:bold;text-align:center;">-->
<!--  <tr>-->
<!--    <td>Bandpowers 1–5</td>-->
<!--    <td>Bandpowers 1–9</td>-->
<!--  </tr>-->
<!--</thead>-->
<!--<tbody style="vertical-align:text-top;">-->
<!--  <tr>-->
<!--    <td>-->
<!--	<ol>-->
<!--	<li>*No jack outliers*</li>-->
<!--	</ol>-->
<!--    </td>-->
<!--    <td>-->
<!--      <ol>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'9', lmax:'500', figtype:'c4', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2020'});">EE inner/outer jackknife (χ)</a> - 0.003* </li>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'9', lmax:'500', figtype:'c4', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2020'});">EE tile/deck jackknife (χ)</a> - 0.002 </li>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'1', lmax:'500', figtype:'c3', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2020'});">EE deck jackknife (χ²)</a> - 0.002 </li>-->
<!--<li><a href="javascript:update_params({dp:'1102', jack:'4', lmax:'500', figtype:'c3', pb:'_pureB_cm_overfreq', bpwf:'', simrd:'', cross1:'1', cross2: '3', version:'B2020'});">EB tile jackknife (χ²)</a> - 0.001* </li>-->
<!--      </ol>-->
<!--    </td>-->
<!--  </tr>-->
<!--<tbody>-->
<!--</table>-->

<script type="text/javascript">
    function update_params(newparams) {
        for (key of Object.keys(param)) {
            if (newparams[key] !== undefined) {
                param[key] = newparams[key];
            }
        }
        plupdate();
    }
    // Parameters that the user can set using the
    // pager buttons.  These are the options that will
    // come up by default when the page first loads.
    // You can define whatever parameters you like,
    //   param.something='value';
    var param = {};
    param.dp='1102';
    param.jack='1';
    param.lmax='500';
    param.figtype='c6';
    param.pb='';
    param.bpwf='';
    param.simrd='';
    param.cross1='1';
    param.cross2='3';
    param.version='Legacy B2017+B2018';
    param.year = '2019';
    param.sim = '99';
    param.bins = '10';


    function make_fignames() {
        fig.fig1={};
	fig.chitab={};
        var rot = '';
        var daughter = '';
        var bpwf = param.bpwf;
		
        // Deal with choosing cross spectra consistently.
        var c1 = parseInt(param.cross1);
        var c2 = parseInt(param.cross2);
        var c11 = Math.min(c1, c2);
        var c22 = Math.max(c1, c2);

        // Define map names for all possible crosses
        var exmap = {};
        // Allow versions to modify the path and map names used:
        switch (param.version) {
    case 'BK B2017+B2018':
      vs = '6614';
      daughter = 'gh';
      break;

    case 'Legacy B2017+B2018':
      vs = '6606';
      daughter = 'gh';
      break;

          case 'Legacy 17+18 Derotated':
            vs = '6666';
            daughter = 'gh';
            break;

          case 'Reanalysis B2017+B2018':
            vs = '6621';
            daughter = 'gh';
            break;
        }

        // Build map extention to use based on choices.
        exname = exmap[c11] + 'x' + exmap[c22];

        foc='final';
        if (param.figtype[0]=='c') {
            figtype=param.figtype[1];
            foc='chi2';
        } else {
            figtype=param.figtype;
        }

        if (param.figtype[0]=='a') {
          var matname = '';
          if (param.pb == 'matrix_') {
            matname = '_matrix';
          }
          ;
          var custinpname = '';
          if (param.figtype[1] == '2'){
            custinpname = '_custinpmod';
          }
          fig.fig1.fname = 'figs/angle_hist_'+vs+'_'+daughter+ '_jack' + param.jack
                  +'_bins_2_' + param.bins + matname + custinpname +'.png';
        } else {
          fig.fig1.fname = 'final/' + vs + '/final_' + daughter
                  + '_jack' + param.jack + '_global_pol_fits_bins_2_'+param.bins
                  +'_offdiag_0_'+param.pb+'normal_repsim_6614xxx8_chi2_'
                  //+ param.pb + rot + bpwf + param.simrd + '_' + foc + '_'
                  + param.lmax + '_' + figtype + '.png';
        }


	fig.chitab.fname = param.year + '/pte_dist_B' + param.year + '_499.png';    

    }

    set_figname_fun(make_fignames);

    // Automatically colorize the buttons as they're pressed
    //   set_autocolor(1,on_color,off_color)
    //   set_autocolor(0) to turn off this feature
    set_autocolor(1,'Red','LightBlue');

    // Check if the user is looking for particular settings
    get_query_words();

    // Setup for automatic pager button writer
    pager.dp=['Deproj',
        //'1100 rg+dp','1100',
        '1102 rg+dp + meas diff ellipt','1102'
        ];
    pager.pb=['Estimator',
        'normal','',
        //'kendrick','_pureB_cm_overfreq',
        // 'matrix','_pureB_matrix_cm_overfreq'
        ];
    pager.bpwf=['BPWF',
        'mask','',
        // 'direct','_directbpwf'
        ];
    pager.figtype=['Figure',
        // Row 1
        //'raw signal+noise','1',
        //'..after noise debias','2',
        // Row 2
        //'Filter/beam suppression factors','4',
        //'..after filter/beam correction','6',
        // Row 3
        //'','',
        //'','',
        // Row 4
        'spectra fixed y-axis','c1',
        'spectra free y-axis','c6',
        // Row 5
        'bp devs','c2',
        'chi2','c3',
        // Row 6
        'sum bp devs','c4',
        'uncertainties','c5',
      '','','','',
        'angle (EE/BB Jack#)','a1',
            'angle (EE/BB Jack0)','a2',
        ];
    pager.jack=['Jack',
        'None','0',
        'dk','1',
        'scan dir','2',
        '1st/2nd half weights','3',
        'tile','4',
        'phase (az)','5',
        'mux col','6',
        'alt dk','7',
        'mux row','8',
        'tile/dk','9',
        'FP inner/outer','a',
        'tile top/bottom','b',
        'tile inner/outer','c',
        'moon up/down','d',
        'diffpoint best/worst','e',
        '','',
        //'','','','',
        //'experiment','f',
    ];
    pager.simrd=['SimType',
        // Row 1
        'lcdm+noi+dust','',
        '','',
        // Row 2
//        'lcdm+noi+r=0.2','_simr',
//        '','',
        // Row 3
        //'lcdm+noi+dust','_simd'
        ];
    pager.lmax=['lmax',
        '200','200',
        '500','500'
        ];
    pager.cross1=['Cross 1',
        'K_95','1',
        'K_150','2',
        'K_220','3'
        ];
    pager.cross2=['Cross 2',
        'K_95','1',
        'K_150','2',
        'K_220','3'
        ];
    pager.version=['Version',
        //'B2016','B2016',
        //'B2017','B2017',
        //'B2018','B2018',
		//'B2019','B2019',
		//'B2020','B2020'
      'BK B2017+B2018','BK B2017+B2018',
            "","",
      'Legacy B2017+B2018','Legacy B2017+B2018',
            'Legacy 17+18 Derotated','Legacy 17+18 Derotated',
      'Reanalysis B2017+B2018','Reanalysis B2017+B2018',
        ];
    pager.year=['Year',
	'2016','2016',
	'2017','2017',
	'2018','2018',
    '2019','2019',
	'2020','2020',
	];
    pager.sim=['rlz',
	'99','99',
	//'199','199',
	//'299','299',
	//'499','499',
	];
    pager.bins=['bins',
    '9','10',
      '14','15',
    ];
  </script>


  <style type="text/css">
    .mainimage {
      max-width: 1000px;
      /* Resize the image for IE6 */
      width: expression(this.width > 1000 ? 1000: true);
    }
    table#mapspager a { color: #0000ff; }
    table#mapspager hr { margin: 8px 0px; }
    table#mapspager td { vertical-align: middle; }
    table#mapspager, table#mapspager table { border-spacing: 2px; }
  </style>

  <table border="1" id="mapspager">
    <thead style="font-weight:bold; text-align:center;">
      <tr><td>Figure 1</td><td>Final Pager</td></tr>
    </thead>
    <tr>
      <td valign="top">
          <script type="text/javascript">
            auto_pager(['dp','pb','bpwf','figtype','jack','simrd',
                        'bins','version'],
                        'maxcols','2','style','2','figname','fig1');
          </script>
      </td>
      <td align="left" width="900">
        <a href="javascript:location.href=fig.fig1.link;">
          <img src="" name="fig1" class="mainimage"
            onerror="onImgError(this);">
        </a>
      </td>
    </tr>
  </table>

<!--  <h3>Legend for first half of the "Figure types":</h3>-->
<!--    <ul>-->
<!--      <li><span style="color:red; font-weight:bold;">Thick red</span> :-->
<!--          ΛCDM unlensed scalars, zero for jacks</li>-->
<!--      <li><span style="font-weight:bold;">Thick black</span> :-->
<!--          Real data</li>-->
<!--      <li>Colored : ΛCDM lensed scalars + noise realizations</li>-->
<!--    </ul>-->
<!--    <p>Note: Noise Debias done with LCDM unlensed scalars realizations</p>-->

  <h3>Legend for second half of the "Figure types":</h3>
    <h4>spectra</h4>

    <ul>
      <li><span style="color:red; font-weight:bold;">thick red</span> for
          all but BB : ΛCDM unlensed scalars, zero for jacks</li>
      <li><span style="color:red; font-weight:bold;">thick red</span> for BB
          : ΛCDM tensors (\(r=0.2\)), zero for jacks</li>
      <li><span style="color:gray;">thin gray</span> :
          s+n simulations with ΛCDM lensed scalars as signal (sim type 7),
          debiased with ΛCDM unlensed scalars (sim type 2) and noise (sim
          type 6)</li>
      <li><span style="color:gray; font-weight:bold;">thick gray</span> :
          mean of sims (<span style="color:gray;">thin gray</span>)</li>
      <li><span style="color:red;">red points</span> with <span
          style="color:blue;">blue error bars</span> :
          real data, debiased with the ΛCDM unlensed scalars and signflip
          noise (as s+n sims), uncertainties from the spread of the s+n
          sims (<span style="color:gray;">thin gray</span>)</li>
    </ul>

    <h4>bp devs</h4>
    <ul>
      <li><span style="color:gray;">thin gray</span> :
          s+n sims</li>
      <li><span style="color:red;">thin red</span> :
          1 sigma contours</li>
      <li><span style="color:green;">thin green</span> :
          2 sigma contours</li>
      <li><span style="font-weight:bold;">thick black + markers</span> :
          real data</li>
      <li><span style="color:red;">red markers</span> :
          bins that go into chi2 analysis</li>
    </ul>

    <p>Note: The contours mark the simulated bandpower in each bin closest
    to the respective percentile.</p>

    <h4>chi2</h4>
    <ul>
      <li><span style="color:red;">red vertical</span> :
          real data</li>
      <li><span style="color:blue;">blue</span> :
          distribution from s+n sims</li>
      <li><span style="color:green;">green</span> :
          chi2 probability distribution fitted to <span
          style="color:blue">blue</span></li>
    </ul>

    <h4>sum bp devs</h4>
    <ul>
      <li><span style="color:red;">red vertical</span> :
          real data</li>
      <li><span style="color:blue;">blue</span> :
          distribution from s+n sims</li>
    </ul>

    <h4>uncertainties</h4>
    <ul>
      <li><span style="color:red;">red</span> :
          std of s+n sims</li>
      <li><span style="color:blue;">blue</span> :
          std of noise-only sims</li>
    </ul>

    <p>Note: Remember that bandpower is a variance. Hence bandpower error bar
    is the std of a variance. This means noise and sample fluctuation
    components straight add, no quadrature — i.e. the difference between blue
    and red is the signal fluctatution component.</p>

</section>

<section><h2>PTE distributions</h2>
  <p>The PTE values shown here are based on the Kendrick pure-B estimator.</p>

  <table border="1" id="chitab">
    <thead style="font-weight:bold; text-align:center;">
      <tr><td>Figure 2</td><td>Hist. of chi and chi2</td></tr>
    </thead>
    <tr>
      <td valign="top">
          <script type="text/javascript">
            auto_pager(['year'],
                        'maxcols','2','style','2','figname','chitab');
          </script>
      </td>
      <td align="left" width="1200">
        <a href="javascript:location.href=fig.chitab.link;">
          <img src="" name="chitab" class="mainimage"
            onerror="onImgError(this);">
        </a>
      </td>
    </tr>
  </table>

  <p>
  <p> Below are the tables for the PTEs, the <b>bold numbers</b> indicate the pte are < 0.01 or > 0.99. And number with asterisk (*) is when the real data fall outside of the simulated distribuation, and the PTE is calculated with the theoretical fit.
  <h3>B2019 PTE \(\chi\) tables</h3>
  <iframe style="width:100%; height:300px;" src="2019/pte_dist_chi.html"></iframe>

  <h3>B2019 PTE \(\chi^2\) tables</h3>
  <iframe style="width:100%; height:300px;" src="2019/pte_dist_chi2.html"></iframe>

  <h3>B2020 PTE \(\chi\) tables</h3>
  <iframe style="width:100%; height:300px;" src="2020/pte_dist_chi.html"></iframe>

  <h3>B2020 PTE \(\chi^2\) tables</h3>
  <iframe style="width:100%; height:300px;" src="2020/pte_dist_chi2.html"></iframe>

</section>

<hr>

<h3>Linked previous postings</h3>

<style type="text/css">
  /* Also make a postings list align correctly */
  .postinglist {
    display: block; /* Fallback */
    display: table;
    margin: 0px 40px;
    font-size: smaller;
  }
  .postinglist > * {
    display: block; /* Fallback */
    display: table-row;
  }
  .postinglist > * > * {
    display: inline; /* Fallback */
    display: table-cell;
    padding: 0.2em 0;
  }
  .postinglist > * > *:first-child {
    font-weight: bold;
    text-align: right;
    padding-right: 1em;
  }
</style>
<dl class="postinglist">

  <a class="posting" href="../20210924_B2019_B2020_mapspager/">
    <dt>[20210924_B2019_B2020_mapspager]</dt>
    <dd>B2019/B2020 Maps Pager, Real and Realization 001 Simulations</dd>
  </a>


  <a class="posting" href="../20210131_B18_pointingshift_final_pager/">
    <dt>[20210131_B18_pointingshift_final_pager]</dt>
    <dd>B2016-B2018 Final Pager Based on Corrected Pointing</dd>
  </a>

</dl>


  <script type="text/javascript">
    plupdate();
  </script>




</body>
