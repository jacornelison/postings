<!DOCTYPE html>

<!--suppress HtmlDeprecatedAttribute -->
<head>
    <meta charset="utf-8">
    <title>IPR: Unblinding Strategy</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript"
            src="../mathjax/MathJax.js?config=TeX-AMS-MML_SVG">
            // src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

</head>

<body>
<!-- Add my custom pager script -->
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

<header>
    <h1>Isotropic Polarization Rotation Analysis 8: Unblinding Strategy</h1>

    <time datetime="2022-12-13" class="published updated">
        2023 MMM DD
    </time> —
    J. Cornelison
</header>

<hr>

<p>
    This posting is part of a series which comprises the IPR analysis on BICEP3, see <a href="#references">previous postings</a> for more on this.
</p>


<hr>

<section>
    <h2>Questions that still need answers</h2>
    <p>
        Before we talk about unblinding, I wanted to summarize the remaining open threads that need to reviewed and concluded.

    </p>

    <p>
        A link is provided if a draft posting exists for it already.
    </p>

    <p><b>Instrumental Calibration</b></p>
    <ol>
        <li>
            What cross checks do we have on the calibration of the wire grid to gravity?
        </li>
        <ul><li>This is quantified through an in-lab measurement I did at pole and at Harvard last year. Draft Link: <a href="JAC2023h"></a></li></ul>

        <li>
            What cross checks do we have for tracking the orientation of the focal plane?
        </li>
            <ul>
                <li>This draft posting <a href="JAC2023i"></a> wraps up the systematics investigation into the pointing model in which we discuss the uncertainty on the FPU angle.</li>
            </ul>

        <li>
            What is the total uncertainty contribution to the birefringence angle from the instrumental calibration? I.E. what is the total uncertainty on the overall angle predicted by our signal+noise RPS sims?
        </li>
        <ul>
            <li>This is being derived from RPS signal (i.e. modulation curves) plus noise sims which I have been documenting in my thesis, but will ultimately be described in the paper.</li>
            <li>Included in this should be a summary of the error budget which is being developed in the Table 2 of the paper.<a href="IPRpaper"></a></li>
        </ul>
    </ol>
    <p><b>CMB Analysis</b></p>
    <ol>
        <li>What is the predicted impact on the birefringence angle bias/uncertainty from beam systematics?</li>
        <ul><li>Draft Link: <a href="CV2023b"></a></li></ul>
        <li>
            How certain are we that we've got the sign of the birefringence angle correct?
        </li>
        <ul>This requires reconciling the math with what we're actually doing in the code and so far I've only found one inconsistency.</ul>


    </ol>


    <p>
        This seems like a lot but, as you can see, most of these threads have postings associated with them and are close to being closed.
    </p>

</section>

<section>
    <h2>Consistency Tests</h2>
    <p>
        Before we unblind, we'll perform the same consistency tests (i.e. jackknives) on the reprocessed real data as we do for our standard <i><b>r</b></i> analysis as well as an additional consistency test which will help boost our confidence in the RPS-derived angles. All of these jacks will need to pass in order to go ahead with unblinding.
    </p>
    <p>
        So far, I've been skipping the creation of the standard jacks when making sims to save time, but now I'm going back an rerunning them. Information on the extra consistency test, which I call a &Delta;&alpha; test, can be found in this draft posting: <a href="JAC2023g"></a>.
    </p>

</section>

<section>
    <h2>Unblinding Strategy</h2>
    <p>
        Our constraint should take the form of a single number with error bars but there are multiple ways to go about getting that number and we've decided on two in order to have some cross checks.
    </p>

    <ul>
        <li><b>Approach 1 (Sernum 6606):</b> Creating sims with the same configuration in which we expect the real BICEP3 data used for BK18 to be. I.E. the TOD's are made with angles I have measured from the RPS, but the maps are made using ideal polarization angles.</li>
        <li><b>Approach 2 (Sernum 6621):</b> Creating sim TOD's with the RPS-derived angles and then creating both real and sim maps with the RPS-derived polarization angles.</li>
    </ul>

    <p>
        These two parallel approaches are intended to be cross-checks of one another, but if we've done everything right then either approach should spit out the same number for our birefringence constraint.
</p>
    <p>
        In either case, we expect that the angles going into TOD and Map making ($\alpha_{TOD}$, $\alpha_{MAP}$ resp.) are the same for both the sims and real data. That way, the excess angle resulting from cosmic birefringence, $\beta$ (in keeping with the naming convention in the literature), is just the difference between the angle fit from the real spectra, $\alpha_{real}$, and the mean angle from the sims, $\bar{\alpha}_{sims}$.
    </p>

    \begin{equation}
    \begin{split}
    \alpha_{sims} &= \alpha_{TOD}-\alpha_{MAP}\\
    &\\
    \alpha_{real} &= \alpha_{TOD}-\alpha_{MAP}+\beta\\
    &\\
    \beta &= \alpha_{real}-\bar{\alpha}_{sims}\\
    \end{split}
    \end{equation}

    <p>I plan on presenting constraints with angles fit to Type 8 (L-LCDM+Noise+Dust) EB spectra both using our typical 9 bandpowers along with an additional 5 (bins 11-15) which should also provide another level of consistency. As of this posting, I intend to report all four results (2 approaches, 2 &ell;-ranges) in a table in the paper, but have <b>our official results be from Approach 2 fitting to all 14 bins</b>. To use the higher bins will require a confirmation that the beam uncertainties are sufficiently small, but we're currently working on that (See &sect; 4 for a list of things we still need to complete).
    </p>

    <h3>Unblinding Plots</h3>

    <p>The following plots are what I'll be looking at when we officially unblind -- I'm currently substituting the spectra from realization 1 from the sims in lieu of using the real data. Both of the approaches above will each have a set of their own plots. Right now I'm only showing the plots from Approach 1 as the sims for Approach 2 still need to be completed.</p>

    <p>
        Before we even look at angles, I want to first look at the spectra as we normally do for our <b><i>r</i></b> analysis in order to ensure nothing obviously crazy is happening.
        The pager below shows the plots found in our typical final pagers with two major exceptions
        <ol>
    <li>I use Type 8 (L-LCDM+Noise+Dust) sims instead of Type 7's (L-LCDM+Noise)</li>
    <li>My real data won't be debiased since we only care about EB/TB.</li>
</ol>
    </p>


    <figure>
        <img alt="Name pager" id="finalpager" src="#" width="50%"/>
        <figcaption>
            Example "Final Pager" for Approach 1. To remain blinded, all "real" data are just realization 1 from the sims.
        </figcaption>
        <script type="text/javascript">
            function fcn(params){
                return 'figs/'+params.val+'_6606_gh_bins_2_'+params.bins+'.png';
            }

            pager.link("#finalpager",
                {
                    'Figure|val' : ['spectra','BP Dev|bpdev','chi2','Sum BP Dev|bphist'],
                    'N Bins|bins' : ['9|10','14|15'],
                    'Jack|jack' : ['0'],
                },
                fcn);
            pager.setparams({
                'val' : 'spectra',
                'bins': '10',
                'jack' : '0',
            });
        </script>
    </figure>

    <p>    Below is the legend for each of the plots.</p>
    <b>spectra</b>

    <ul>
        <li><span style="color:gray;">thin gray</span> :
            s+n simulations with ΛCDM lensed scalars as signal (sim type 7),
            debiased with ΛCDM unlensed scalars (sim type 2) and noise (sim
            type 6)</li>
        <li><span style="color:gray; font-weight:bold;">thick gray</span> :
            mean of sims (<span style="color:gray;">thin gray</span>)</li>
        <li><span style="color:red;">red points</span> with <span
                style="color:blue;">blue error bars</span> :
            real data, uncertainties from the spread of the s+n
            sims (<span style="color:gray;">thin gray</span>)</li>
    </ul>

    <b>bp devs</b>
    <ul>
        <li><span style="color:gray;">thin gray</span> :
            s+n sims</li>
        <li><span style="color:red;">thin red</span> :
            1 sigma contours</li>
        <li><span style="color:green;">thin green</span> :
            2 sigma contours</li>
        <li><span style="font-weight:bold;">thick black + markers</span> :
            real data</li>
        <li><span style="color:red;">red markers</span> :
            bins that go into chi2 analysis</li>
    </ul>

    <p>Note: The contours mark the simulated bandpower in each bin closest
        to the respective percentile.</p>

    <b>chi2</b>
    <ul>
        <li><span style="color:red;">red vertical</span> :
            real data</li>
        <li><span style="color:blue;">blue</span> :
            distribution from s+n sims</li>
        <li><span style="color:green;">green</span> :
            chi2 probability distribution fitted to <span
                    style="color:blue">blue</span></li>
    </ul>

    <b>sum bp devs</b>
    <ul>
        <li><span style="color:red;">red vertical</span> :
            real data</li>
        <li><span style="color:blue;">blue</span> :
            distribution from s+n sims</li>
    </ul>

    <b>uncertainties</b>
    <ul>
        <li><span style="color:red;">red</span> :
            std of s+n sims</li>
        <li><span style="color:blue;">blue</span> :
            std of noise-only sims</li>
    </ul>

    <p>Note: Remember that bandpower is a variance. Hence bandpower error bar
        is the std of a variance. This means noise and sample fluctuation
        components straight add, no quadrature — i.e. the difference between blue
        and red is the signal fluctatution component.</p>

<hr>


    <p>
        Next, we'll actually look at the histograms of &beta; for fitting to both bin-ranges.
        The standard deviation of the histograms give us the statistical uncertainty from the sims, but we still need to include the systematic uncertainty from the sims (e.g. alternate dust models and beams) and the uncertainty from the instrumental calibration.
    </p>

    <figure>
        <img src="figs\unblinded_hists_6606_test.png">
        <figcaption>
            Histograms of &beta; for Approach 1. The blue bars are the sims and the green line is the real data (rlz 1 of the sims here). The black dotted lines will show the 2&sigma; error bars from the statistical and systematic uncertainty added in quadrature.
        </figcaption>
    </figure>

    <p>Finally, I'll also include a table of &beta; with the final statistical and systematic uncertainties which will include any error we get from the instrumental calibration that aren't already accounted for in the sims.</p>


   <h3>Detection Criteria and Consequences</h3>
    <h4>What constitutes a detection?</h4>
    <p>I'd like to establish a detection threshold of 2&sigma;, i.e. our constraint will be consistent with the null hypothesis if it satisfies:</p>

    \begin{equation}
    \label{eq:sigthresh}
    \frac{|\beta|}{\sigma_{\beta}} \le 2
    \end{equation}

<p>
    I chose 2&sigma; specifically because I've done a majority of this analysis by myself. I am confident in my abilities that the chances I've seriously messed up something is on the order of one in 20, but not necessarily less than one in 100 (i.e. 2.5&sigma;).
</p>

    <p>If our value of &beta; satisfies Eq. \ref{eq:sigthresh}, then we will finish the paper establishing some nice bounds on isotropic birefringence.</p>


    <h4>What happens if we've detected something?</h4>
    <p>One could pose the argument that if we are confident enough to publish a &beta;=0 constraint, then we should be confident enough to publish a &beta;&ne;0 constraint.
    My major counterpoint to this argument is that I've been solely responsible for most of the parts of this very complicated analysis and while we have no reason to believe that &beta;=0 would be a result from some systematics I've missed, I think that a significant detection of &beta; should at least warrant getting some other eyes on all of the little details that went into the result.
    </p>
<p>
    That said, I propose that if &beta;&ne;0 to greater than the 2.5&sigma; threshold, then we pause releasing the paper until we can
    <ol type="A">
    <li>Have at least one other person who isn't me, Clara, or John independently go through the entire analysis</li>
    <li>Maybe get another RPS observation as an independent cross check.</li>

</ol>
</p>

    <p>
        I predict that the first question that might be asked is "then why don't we just wait to unblind and do those things first?" and my answer to that is "I need to graduate and it'd be <i>real</i> unsatisfying to get all this way and not have a result in my thesis". Here at Harvard, we can embargo the public release of our thesis for up to one year, so if we have a non-zero result my plan is to finish my thesis including these results and hold the public release so that we have time to complete the steps above.
    </p>

</section>



<section><h2>Conclusions</h2>

</section>

<hr>

<section class="appendix">
<h2 class="appendix">Appendix</h2>
    <h3>Footnotes</h3>
    <p>Click on the number to return to the main text.</p>
    <div class="footnote">
        <p>
        <sup><a name="ftn1" href="#sup1">[1]</a></sup>
    </p>
    </div>

    <!--
    <h3>Code</h3>
    <p>Below is a list of code that was used for this analysis. The code is committed to the pipeline and can be found in the <tt>analysis/beammap/</tt> directory.</p>
    <p id="code"></p>

    <p id="testp"></p>

    <script type="text/javascript">

        // Shorthand tags
        var codes = [
            "rps_fit_mirror_from_moon.m",
            ];

        // Posting titles
        var desc = [
            "Derives mirror parameters from observations of the moon.",
        ];

        // Make a list of references
        var post = document.getElementById("code");
        var msg = "<table class=\"code\">";
        for (var code in codes){
            msg = msg + "<tr><td><tt>"+codes[code]+"</tt></td><td> - </td><td>"+desc[code]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

    </script>


    <h3>Data</h3>
    <p id="data"></p>



    <script type="text/javascript">

        // Shorthand tags
        var data = [
            "moonsch.mat",
            ];

        // Posting titles
        var desc = [
            "Metadata of Moon observations",
            ];

        // Make a list of references
        var post = document.getElementById("data");
        var msg = "<table class=\"code\">";
        for (var datum in data) {
            msg = msg + "<tr><td><tt>" + data[datum] + "</tt></td><td> - </td><td>" + desc[datum] + "</td>";
        }
        ;
        msg = msg + "</table>";
        post.innerHTML = msg;

    </script>
-->


    <h3>References</h3>

    <p id="references"></p>


    <script type="text/javascript">

        // This my way of making shorthand links.
        // We'll make a couple arrays with the 'tag' and href information
        // and then look through each anchor element for the specified tag.
        // The anchors should then just look like: <a href="tagname"></a>
        // and the script will automatically fill in the hyperlings and text.


        var posting_dir = window.location.href; // What's the current url?

        var bkurl = "bicep.rc.fas.harvard.edu";
        var spurl = "bicep.usap.gov";

        // These are the possible places to find postings
        // The strings are for if you post your posting in that directory.
        var sitemap = {
            jcornelison: "../../../",   // /jcornelison/postings/
            cverges: "../../",          // cverges/
            bkcmb : "../../../../",     // /bkcmb/analysis_logbook/analysis/
            bicep3: "../../../",        //
            bicep_array: "../../../",   //
            bicep2: "",                 // We shouldn't be posting in these, but still have postings we can reference.
            keck  : "",                 // keck/analysis_logbook/analysis/
            spuder: "",                 // ~spuder/hieno_analysis_logboo
            bicep1: "",                 // ~bicep1/analysis_logbook_north/
            general_projects:"",
                   };
        // Logbook Site map:
        // personal:www/jcornelison/postings/
        // bkcmb:   www/bkcmb/analysis_logbook/analysis/
        // keck:    www/keck/analysis_logbook/analysis/
        // BICEP3:  www/bicep3/analysis_logbook/
        // BA:      www/bicep_array/analysis_logbook/
        // We shouldn't be posting in these, but still have postings.
        // bicep2:
        // keck:    www/keck/analysis_logbook/analysis/
        // spuder:  www/~spuder/hieno_analysis_logbook/
        // bicep1:  www/~bicep1/analysis_logbook_north/

        // Shorthand tags
        var tags = [
            "JAC2023a",
            "JAC2023b",
            "JAC2023c",
            "JAC2023d",
            "JAC2023e",
            "JAC2023f",
            "CV2023a",
            "JAC2023g",
            "CV2023b",
            "JAC2023h",
            "JAC2023i",
            "IPRpaper",
        ];

        // Links
        // Truncate the link down to the www directory in which it lies if you can.
        // This ensures that we can view the linked postings at Pole without the internet.
        var hrefs = [
            "bkcmb/analysis_logbook/analysis/20230207_IPR_angle_fits_to_B2018/",
            "bkcmb/analysis_logbook/analysis/20230214_IPR_B18_mat_pure/",
            "bkcmb/analysis_logbook/analysis/20230214_IPR_pol_rot_sims/",
            "bkcmb/analysis_logbook/analysis/20230328_IPR_high_ell/",
            "bkcmb/analysis_logbook/analysis/20230328_IPR_forecasting/",
            "jcornelison/postings/20230321_IPR_B18_subsets/",
            "cverges/20221215_alt_dust_sim/",
            "jcornelison/postings/2023mmdd_IPR_det_subset_jacks/",
            "cverges/20230428_EB_bmsims/",
            "jcornelison/postings/2023mmdd_isaac_data/",
            "jcornelison/postings/2022mmdd_rps_pointing/",
            "https://www.overleaf.com/read/qdbjrtybxdxq",
        ];


        // Posting titles
        var desc = [
            "Isotropic Polarization Rotation Analysis: Global Polarization Rotation Fits on Standard B2018 Sims",
            "Isotropic Polarization Rotation Analysis 2: B18 sims and combined EB+TB fits",
            "Isotropic Polarization Rotation Analysis 3: B2018 Polarization Rotation sims",
            "Isotropic Polarization Rotation Analysis 4: Angle estimates including higher ell-bins",
            "Isotropic Polarization Rotation Analysis 5: Basic Forecasting of Angle Uncertainty on B18 sims",
            "Isotropic Polarization Rotation Analysis 6: Angle Fits With Reduced Coverage in B18 sims",
            "Isotropic Polarisation Rotation Analysis 7: Alternate dust models",
            "Isotropic Polarization Rotation Analysis 9: An RPS Angle Subset Jack",
            "Isotropic Polarization Rotation Analysis 10: T&rightarrow;P leakage systematics",
            "Summary of RPS Angle Cross Checks with the ISAAC",
            "2022 RPS Analysis: Observations and Pointing Systematics",
            "IPR Analysis Paper",
        ];
        // Debug
        var posty = document.getElementById("testp");


        var preface = "";
        var keys = Object.keys(sitemap);
        // If we're not at pole or bicep, just post the full URL
        // If we are, go back to the www directory.
        if (posting_dir.match(new RegExp(bkurl))!=bkurl &
            posting_dir.match(new RegExp(spurl))!=spurl){
                preface = "http://" + bkurl+"/";
            }
        else {
            for (key in keys){
                if (posting_dir.match(new RegExp("/"+keys[key]+"/"))=="/"+keys[key]+"/"){
                    preface = sitemap[keys[key]];
                };
            };

        };

        // Add the prefixes we can.
        // Only add prefixes to directories in the sitemap so we don't break
        // external references.
        for (ref in hrefs) {
            for (key in keys) {

            // If there's a match, at the prefix and move on.
            if(hrefs[ref].match(new RegExp(keys[key] + "/"))==keys[key]+"/"){
                hrefs[ref] = preface+hrefs[ref];
                break;
            }
            };
        };

        // posty.innerHTML = preface;

        // Make a list of references
        var post = document.getElementById("references");
        var msg = "<table>";
        for (var tag in tags){
            msg = msg + "<tr><td><a href="+tags[tag]+"></a></td><td> - </td><td>"+desc[tag]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

        // Look through all the hyperlinks and insert the proper links to the postings
        var links = document.getElementsByTagName("A");
        for (var link in links){
            for (var tag in tags){
                if (links[link].href.endsWith(tags[tag])){
                    links[link].text = "("+tags[tag]+")";
                    links[link].href = hrefs[tag];
                    links[link].target = "_blank";
                }
            }
        }

    </script>
</section>
</body>
