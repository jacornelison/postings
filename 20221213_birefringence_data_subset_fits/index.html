<!DOCTYPE html>

<!--suppress HtmlDeprecatedAttribute -->
<head>
    <meta charset="utf-8">
    <title>polrot data subsets</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript"
            src="../mathjax/MathJax.js?config=TeX-AMS-MML_SVG">
            // src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

</head>

<body>
<!-- Add my custom pager script -->
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

<header>
    <h1>Isotropic Polarization Rotation Analysis: Cross checking angles in B2018 data subsets</h1>

    <time datetime="2020-xx-xx" class="published updated">
        2023 Jan 20
    </time> â€”
    J. Cornelison
</header>

<hr>

<p>
The goal of this posting is to demonstrate a procedure to split CMB data into subsets and comparing their angles which will serve as an important consistency check on the as-measured polarization angles during unblinding.
</p>

<hr>

<section>
    <h2>Cross-checking RPS Polarization Angles</h2>
    <p>
        We've come up with a procedure to cross-check that the RPS-derived polarization angles without unblinding ourselves to the birefrinence angle.

        A comparison of my preliminary RPS measurements vs the polarization angles we're currently using to make maps shows a variance across the focal plane on the order of ~1&deg;.

        That means that I should be able to split our real coadded maps into subsets based on the angle we expect from our RPS-derived polarization angles and then compare the <i>difference</i> in global rotation angle among the different subsets. Since we're looking only at relative differences, we keep ourselves blind to the absolute birefringence angle. While it doesn't really give us information on the absolute angle, having a confirmation that I got the relative angles correct lends confidence that there isn't something glaringly wrong in the RPS analysis.
    </p>
    <p>
        The figure below shows how the data could be split up. In this case, I choose to split the pairs evenly into thirds where the mean difference in global rotation angle between the lower-to-middle and middle-to-upper datasets is expected to be ~0.3&deg;.
    </p>

    <figure>
        <img src="figs/hist_diffphi.png">
        <figcaption>
            Histogram of the difference between RPS-derived and CMB-derived pair-diff polarization angles. The colored vertical lines denote the intended grouping of the subsets of data.
        </figcaption>
    </figure>

    <p>
        I now fit the global rotation angle to each signal type of each subset and examine the distributions.
    </p>

    <p>As we saw in my previous posting <a href="JAC2023b"></a>, we can calculate the expected angles by taking the uniform mean of the difference between the RPS-derived and CMB-derived polarization angles.</p>

    <p>Expected angles:</p>

    <ul>
        <li>B2018+RPS: -0.778&deg;</li>
        <li>subset-lower: -1.069&deg;</li>
        <li>subset-middle: -0.796&deg;</li>
        <li>subset-upper: -0.468&deg;</li>
    </ul>

    <p>The pager below shows the expected angle vs. the mean alpha of the the realizations per-signal type with the 1-&sigma; standard deviations as the error bars.</p>


    <figure>
        <img alt="Name pager" id="comparpager" src="#" onerror=this.src="figs/blank.png" width="75%"/>
        <figcaption>

        </figcaption>
        <script type="text/javascript">
            pager.link("#comparpager",
                {
                    'Signal Type|sig2': ['Unlensed-LCDM|2','Lensed-LCDM|5','L-LCDM+Noise|7','L-LCDM+N+Dust|8'],

                },
                function(params) {
                    return 'figs/subset_mean_compare_type_'+params.sig2+'.png';
                });
            pager.setparams({
                'sig2': '2',

            });
        </script>
    </figure>



    <p>The pager below shows the resulting differences of the angles </p>

    <figure>
        <img alt="Name pager" id="diffpager" src="#" onerror=this.src="figs/blank.png" width="75%"/>
        <figcaption>

        </figcaption>
        <script type="text/javascript">
            pager.link("#diffpager",
                {
                    'Signal Type|sig2': ['Unlensed-LCDM|2','Lensed-LCDM|5','L-LCDM+Noise|7','L-LCDM+N+Dust|8'],

                },
                function(params) {
                    return 'figs/subset_diff_compare_type_'+params.sig2+'.png';
                });
            pager.setparams({
                'sig2': '2',

            });
        </script>
    </figure>




</section>
<section><h2>Conclusions</h2>

</section>

<hr>

<section class="appendix">
<h2 class="appendix">Appendix</h2>

    <h3>APS for data Subsets</h3>

    <figure>
        <img alt="Name pager" id="apspager2" src="#" width="85%" onerror=this.src="figs/blank.png" />
        <figcaption>

        </figcaption>

        <script type="text/javascript">
            pager.link("#apspager2",
                {
                    'Signal Type|sig2': ['2','3','5','6','7','8'],
                    'Simset|sernum3': ['B2018|6614','B2018+RPS|6606','subset-lower|6607','subset-middle|6608','subset-upper|6609'],
                    'y-axes|axes': ['Fixed|_fixed','Free|_free']
                },
                function(params) {
                    return 'figs/aps_'+params.sernum3+'_matrix_'+params.sig2+params.axes+'.png';
                });
            pager.setparams({
                'sig2': '2',
                'sernum3': '6607',
                'axes': '_fixed',
            });
        </script>
    </figure>

<h3>Alpha histograms for data subsets</h3>

    <figure>
        <img alt="Name pager" id="histpager3" src="#" onerror=this.src="figs/blank.png" width="100%"/>
        <figcaption>

        </figcaption>
        <script type="text/javascript">
            pager.link("#histpager3",
                {
                    'Signal Type|sig': ['Unlensed-LCDM|2','Dust Only|3','Lensed-LCDM|5','Noise Only|6','L-LCDM+Noise|7','L-LCDM+N+Dust|8'],
                    'Simset|sernum5': ['B2018+RPS|6606','subset-lower|6607','subset-middle|6608','subset-upper|6609'],
                },
                function(params) {
                    return 'figs/alpha_hist_'+params.sernum5+'matrix_'+params.sig+'_corr.png';
                });
            pager.setparams({
                'sig': '2',
                'sernum5': '6606',
            });
        </script>
    </figure>



    <h3>Focal Plane Coverage for data subsets</h3>
    <figure>
        <img alt="Name pager" id="coveragepager" src="#" onerror=this.src="figs/blank.png" width="65%"/>
        <figcaption>
            Focal plane coverage for each of the simsets. Yellow indicates detector pairs used in the coadds.
        </figcaption>
        <script type="text/javascript">
            pager.link("#coveragepager",
                {
                    'Simset|sernum4': ['B2018-rerun|6600','subset-lower|6603','subset-middle|6604','subset-upper|6605'],
                },
                function(params) {
                    return 'figs/'+params.sernum4+'_tile_plot.png';
                });
            pager.setparams({
                'sernum4': '6600',
            });
        </script>
    </figure>


    <h3>Footnotes</h3>
    <p>Click on the number to return to the main text.</p>
    <div class="footnote">
        <p>
        <sup><a name="ftn1" href="#sup1">[1]</a></sup>

    </p>
    </div>
    <h3>Code</h3>
    <p>Below is a list of code that was used for this analysis. The code is committed to the pipeline and can be found in the <tt>analysis/beammap/</tt> directory.</p>
    <p id="code"></p>

    <h3>Data</h3>
    <p id="data"></p>
    <h3>References</h3>

    <p id="references"></p>


    <p id="testp"></p>

    <script type="text/javascript">

        // Shorthand tags
        var codes = [
            "dummycode.m",
            ];

        // Posting titles
        var desc = [
            "dummy description",
        ];

        // Make a list of references
        var post = document.getElementById("code");
        var msg = "<table class=\"code\">";
        for (var code in codes){
            msg = msg + "<tr><td><tt>"+codes[code]+"</tt></td><td> - </td><td>"+desc[code]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

    </script>

    <script type="text/javascript">

        // Shorthand tags
        var data = [
            "dummydata.mat",
            ];

        // Posting titles
        var desc = [
            "Dummy description",
            ];

        // Make a list of references
        var post = document.getElementById("data");
        var msg = "<table class=\"code\">";
        for (var datum in data) {
            msg = msg + "<tr><td><tt>" + data[datum] + "</tt></td><td> - </td><td>" + desc[datum] + "</td>";
        }
        ;
        msg = msg + "</table>";
        post.innerHTML = msg;

    </script>



    <script type="text/javascript">

        // This my way of making shorthand links.
        // We'll make a couple arrays with the 'tag' and href information
        // and then look through each anchor element for the specified tag.
        // The anchors should then just look like: <a href="tagname"></a>
        // and the script will automatically fill in the hyperlings and text.


        var posting_dir = window.location.href; // What's the current url?

        var bkurl = "bicep.rc.fas.harvard.edu";
        var spurl = "bicep.usap.gov";

        // These are the possible places to find postings
        // The strings are for if you post your posting in that directory.
        var sitemap = {
            jcornelison: "../../../",   // /jcornelison/postings/
            bkcmb : "../../../../",     // /bkcmb/analysis_logbook/analysis/
            bicep3: "../../../",        //
            bicep_array: "../../../",   //
            bicep2: "",                 // We shouldn't be posting in these, but still have postings we can reference.
            keck  : "",                 // keck/analysis_logbook/analysis/
            spuder: "",                 // ~spuder/hieno_analysis_logboo
            bicep1: "",                 // ~bicep1/analysis_logbook_north/
            general_projects:"",
                   };
        // Logbook Site map:
        // personal:www/jcornelison/postings/
        // bkcmb:   www/bkcmb/analysis_logbook/analysis/
        // keck:    www/keck/analysis_logbook/analysis/
        // BICEP3:  www/bicep3/analysis_logbook/
        // BA:      www/bicep_array/analysis_logbook/
        // We shouldn't be posting in these, but still have postings.
        // bicep2:
        // keck:    www/keck/analysis_logbook/analysis/
        // spuder:  www/~spuder/hieno_analysis_logbook/
        // bicep1:  www/~bicep1/analysis_logbook_north/

        // Shorthand tags
        var tags = [
            "JBW2016",
            "EWB2016a",
            "EWB2016b",
            "JAC2023a",
            "JAC2023b"
        ];

        // Links
        // Truncate the link down to the www directory in which it lies if you can.
        // This ensures that we can view the linked postings at Pole without the internet.
        var hrefs = [
            "bkcmb/analysis_logbook/analysis/20160907_polrot/",
            "bkcmb/analysis_logbook/analysis/20161103_polrotsims_pager/",
            "bkcmb/analysis_logbook/analysis/20161215_rot_sims_polrot/",
            "jcornelison/postings/20221213_birefringence_fits_to_B2018/index.html",
            "jcornelison/postings/20221213_birefringence_pol_rot_sims/",

        ];


        // Posting titles
        var desc = [
            "Birefringence/Polarization rotation in K2015 and BK15",
            "Polarization Rotation Sims Pager",
            "Polarization Rotation Sims Global Rotation",
            "Uniform Birefringence Analysis I: Global Polarization Rotation Fits on Standard B2018 Sims",
            "Isotropic Birefringence Analysis: Global Polarization Rotation Angles in B2018 sims",
        ];
        // Debug
        var posty = document.getElementById("testp");


        var preface = "";
        var keys = Object.keys(sitemap);
        // If we're not at pole or bicep, just post the full URL
        // If we are, go back to the www directory.
        if (posting_dir.match(new RegExp(bkurl))!=bkurl &
            posting_dir.match(new RegExp(spurl))!=spurl){
                preface = "http://" + bkurl+"/";
            }
        else {
            for (key in keys){
                if (posting_dir.match(new RegExp("/"+keys[key]+"/"))=="/"+keys[key]+"/"){
                    preface = sitemap[keys[key]];
                };
            };

        };

        // Add the prefixes we can.
        // Only add prefixes to directories in the sitemap so we don't break
        // external references.
        for (ref in hrefs) {
            for (key in keys) {

            // If there's a match, at the prefix and move on.
            if(hrefs[ref].match(new RegExp(keys[key] + "/"))==keys[key]+"/"){
                hrefs[ref] = preface+hrefs[ref];
                break;
            }
            };
        };

        // posty.innerHTML = preface;

        // Make a list of references
        var post = document.getElementById("references");
        var msg = "<table>";
        for (var tag in tags){
            msg = msg + "<tr><td><a href="+tags[tag]+"></a></td><td> - </td><td>"+desc[tag]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

        // Look through all the hyperlinks and insert the proper links to the postings
        var links = document.getElementsByTagName("A");
        for (var link in links){
            for (var tag in tags){
                if (links[link].href.endsWith(tags[tag])){
                    links[link].text = "("+tags[tag]+")";
                    links[link].href = hrefs[tag];
                    links[link].target = "_blank";
                }
            }
        }

    </script>
</section>
</body>
