<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Posting Title — J. Cornelison</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
	<script type="text/x-mathjax-config">
        MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript"
        src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>

<body>
<!-- Add my custom pager script -->
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

<header>
    <h1>RPS Analysis: Rederiving Mirror Parameters </h1>

    <time datetime="2020-xx-xx" class="published updated">
        2021 Mmm dd
    </time> —
    J. Cornelison
</header>

<hr>

<p>We found that the largest errors on absolute polarization angles estimated from the RPS analysis resulted from the mirror analysis. I did not perform moon observations during the Jan 2018 calibration campaign and so my RPS analysis involves using moon obervations and the RPS location from the previous year to derive the mirror parameters for 2018 which, if not handled properly, can easily propagate large errors into the final results. In this posting, I take a fresh look at the Jan 2017 moon data to acquire mirror parameters for 2018 with reduced systematic errors.</p>

<hr>

    <p>To summarize, we compare beam centroids from moon observations to estimate the mirror tilt, mirror roll, and drum angle. We then lock in these mirror and drum angle parameters and use beam centers from RPS data to estimate the location of the RPS. For the 2018 RPS data, no moon observations were taken so we estimate the location of the source from 2017 moon and (prelimenary) RPS observations and, assuming the RPS was placed at the same location the next year, we fit for the Jan 2018 mirror parameters using RPS data.</p>

<section><h2>Mirror Parameters 2017</h2>

    <p>In the previous attempt <a href="JAC2019"></a>, we estimated the mirror tilt and roll parameters by fitting 2D Gaussians to detector timestreams in boresight-centered ($r/\theta$) coordinates returned by a pointing model <tt>keck_beam_map_pointing.m</tt> (described in <a href="CAB2014"></a>):</p>

    \begin{equation}
    [r,\,\,\theta] = \text{keck_beam_map_pointing}(Tilt,\,Roll\,|\, Az,\,El,\,Dk,\,Mount,\, Moon)
    \end{equation}


    where $Mount$ contains the relevant mount information derived from Solidworks drawings; $Moon$ containts the on-sky, per-timestream-sample location of the moon; and $Az$, $El$, and $Dk$ are converted from raw encoder vlaues to topocentric coordinates using starpointing. We converted $r/\theta$ into $x/y$ coordinates using Lambert azimuthal equal-area projection (see <a href="IDB2013"></a>)


    \begin{equation}
    x = 2 \sin(r/2) \cos(\theta)\\
    y = 2 \sin(r/2) \sin(\theta)
    \end{equation}

    and then fit the beams.

    <p>The datasets for the moon observations are huge so re-estimating beam centroids from 2D Gaussian models for each permutation of the roll-tilt-drumangle parameter space isn't computationally feasible. In the previous analysis, I mitigated this by only analyzing a few detectors at a single deck angle. Instead, I take the Az/El/Dk position at the max amplitude of the timestream as the beam centroid. This drastically reduces computation time of the fit which allows me to quickly fit all of the available detectors across all three datasets at the expense of increased uncertainty of the beam centroids<sup>[<a name="sup1" href="#ftn1">1</a>]</sup>.</p>

    <p>So Eq. 1 becomes</p>
    \begin{equation}
    [r_{0},\,\,\theta_{0}] = \text{keck_beam_map_pointing}(Tilt,\,Roll\,|\, Az_0,\,El_0,\,Dk_0,\,Mount,\, Moon)
    \end{equation}

    where $Az_0$, $El_0$, and $Dk_0$ are the per-detector positions at max amplitude and $r_{0}$ and $theta_{0}$ are the beam centers (converted to $x_0/y_0$ using Eq. 2).
    <p>Then using CMB-derived beam centers as the 'observed' quantity, the chi-square to minimize is just:</p>

    \begin{equation}
    \chi^2=\sum \frac{(x_{CMB,i}-x_{0,i})^2+(y_{CMB,i}-y_{0,i})^2}{\sigma_i^2}
    \end{equation}

    <p>
        which is done using our Matlab wrapper of <i>MINUIT</i> called <tt>matmin.m</tt>. I estimate the statistical uncertainty using bootstrapping.
    </p>



    <h3>Data</h3>
    <h4>Moon Observations</h4>
    <figure>
        <table>
            <tr>
                <th>Schedule</th>
                <th>Start</th>
                <th>End</th>
                <th>DK</th>
            </tr>
            <tr>
                <td>8_ffflat_moonraster_28_dk000_001.sch</td>
                <td>170121 22:29:58</td>
                <td>170121 23:25:36</td>
                <td>0</td>
            </tr>
            <tr>
                <td>8_ffflat_moonraster_28_dk045_001.sch</td>
                <td>170121 23:26:36</td>
                <td>170122 00:20:45</td>
                <td>45</td>
            </tr>
            <tr>
                <td>8_ffflat_moonraster_28_dk090_001.sch</td>
                <td>170122 00:36:46</td>
                <td>170122 01:31:05</td>
                <td>90</td>
            </tr>

        </table>

    </figure>

    <figure>
        <img src="figs/moon_coverage_2017.png" />
        <figcaption>
            Focal plane coverage of the three 2017 moon observations used for this analysis. Topocentric coordinates were converted into x/y coordinates using best-fit mirror tilt, roll parameters.
        </figcaption>
    </figure>

    <h4>Ephemeris Data</h4>

    <p>In my previous effort, I used
    </p>


<h3>Results</h3>

    The results shown in the table below are from fitting to observations at all three Deck angles. My 2019 results, which fit only to the DK=0 observation, were $[Tilt=44.51^\circ,\,Roll=0.11^\circ]$ for comparison.

    <!--
    Param	Best-Fit	Stat Uncert	Sys Uncert
    -----	--------	-----------	----------
    Tilt 	44.6014  	0.0004  	0.0010
    Roll 	0.0007  	0.0007	    0.0247
    -->

    <table class="center">

        <tr>
            <th>Parameter</th>
            <th>Best-Fit (&deg;)</th>
            <th>Stat. Uncert. (&deg;)</th>
            <th>Sys. Uncert. (&deg;)</th>
        </tr>
        <tr>
            <td>Tilt</td>
            <td>44.601</td>
            <td>0.004</td>
            <td>0.001</td>

        </tr>
        <tr>
            <td>Roll</td>
            <td>0.0007</td>
            <td>0.0007</td>
            <td>0.0247</td>
        </tr>

    </table>

    <p></p>

    <figure>
        <img src="figs/moonfit_residuals_scatterhist.png" />
        <figcaption>
            Best fit residuals</b>.
        </figcaption>
    </figure>
    <figure>
        <img src="figs/moonfit_residuals_quiver_zoomed.png" />
        <figcaption>
            Best fit residuals</b>.
        </figcaption>
    </figure>
<h3>Systematics</h3>

    <p>
        The list of possible sources of systematics includes the error on the CMB-derived beam centers; both the aperture height from the elevation axis and mirror height from the aperture given by solidworks drawings; and all of the relevant mount parameters estimated from starpointing. The CMB-derived parameters discussed in <a href="JWB2018"></a> have a quoted error of 0.012&deg; in x/y. For the elevation-axis-to-aperture distance, I use a conservative 1cm to account for any imprecision in the location of the aperture. For the mirror height, I use a conservative estimate of 10cm to account for the small amount of travel in the legs. The statistical error given with the starpointing data is the parabolic error returned by <tt>matmin</tt> which is not properly normalized. Instead, I acquire an estimate of the uncertainty once again using a bootstrap of the star pointing data used for this particular analysis. As a conservative estimate, I double the uncertainty returned by the bootstrap.
    </p>
    <h4>Methods</h4>
    <p>Words</p>

    <figure>
<table class="center">
    <tr>
        <th>CMB-derived Beam Centers</th>
        <th></th>
        <th></th>
        <th></th>
    </tr>
    <tr>
        <th>Parameter</th>
        <th>Uncertainty (m)</th>
        <th>Bias Tilt (&deg;)</th>
        <th>Bias Roll (&deg;)</th>
    </tr>
    <tr>
        <td>x/y</td>
        <td>$0.0120$</td>
        <td>$^{0.0002}_{-0.0002}$</td>
        <td>$^{0.0002}_{-0.0002}$</td>
    </tr>
    <tr>
        <th>Solidworks</th>
        <th></th>
        <th></th>
        <th></th>
    </tr>
    <tr>
        <th>Parameter</th>
        <th>Uncertainty (m)</th>
        <th>Bias Tilt (&deg;)</th>
        <th>Bias Roll (&deg;)</th>
    </tr>
    <tr>
        <td>Aperture Height</td>
        <td>$0.0100$</td>
        <td>$^{0.0000}_{0.0000}$</td>
        <td>$^{0.0001}_{0.0001}$</td>
    </tr>
    <tr>
        <td>Mirror Height</td>
        <td>$0.1000$</td>
        <td>$^{0.0000}_{0.0000}$</td>
        <td>$^{0.0001}_{0.0001}$</td>
    </tr>
    <tr>
        <th>Star Pointing</th>
        <th></th>
        <th></th>
        <th></th>
    </tr>
    <tr>
        <th>Parameter</th>
        <th>$2\sigma$ Stat. Uncert. (&deg;)</th>
        <th>Bias Tilt (&deg;)</th>
        <th>Bias Roll (&deg;)</th>
    </tr>
    <tr>
        <td>flex_cos</td>
        <td>$0.0000$</td>
        <td>$^{NaN}_{NaN}$</td>
        <td>$^{NaN}_{NaN}$</td>
    </tr>
    <tr>
        <td>flex_sin</td>
        <td>$0.0000$</td>
        <td>$^{NaN}_{NaN}$</td>
        <td>$^{NaN}_{NaN}$</td>
    </tr>
    <tr>
        <td>az_tilt_ha</td>
        <td>$0.0015$</td>
        <td>$^{0.0003}_{-0.0003}$</td>
        <td>$^{0.0037}_{-0.0037}$</td>
    </tr>
    <tr>
        <td>az_tilt_lat</td>
        <td>$0.0015$</td>
        <td>$^{0.0007}_{-0.0007}$</td>
        <td>$^{-0.0014}_{0.0015}$</td>
    </tr>
    <tr>
        <td>el_tilt</td>
        <td>$0.0082$</td>
        <td>$^{0.0001}_{-0.0001}$</td>
        <td>$^{0.0223}_{-0.0223}$</td>
    </tr>
    <tr>
        <td>collim_x</td>
        <td>$0.0000$</td>
        <td>$^{NaN}_{NaN}$</td>
        <td>$^{NaN}_{NaN}$</td>
    </tr>
    <tr>
        <td>collim_y</td>
        <td>$0.0000$</td>
        <td>$^{NaN}_{NaN}$</td>
        <td>$^{NaN}_{NaN}$</td>
    </tr>
    <tr>
        <td>collim_mag</td>
        <td>$0.0012$</td>
        <td>$^{0.0000}_{0.0000}$</td>
        <td>$^{0.0000}_{0.0000}$</td>
    </tr>
    <tr>
        <td>collim_dir</td>
        <td>$0.1279$</td>
        <td>$^{0.0000}_{0.0000}$</td>
        <td>$^{0.0000}_{0.0000}$</td>
    </tr>
    <tr>
        <td>az_zero</td>
        <td>$0.0145$</td>
        <td>$^{0.0001}_{-0.0001}$</td>
        <td>$^{-0.0097}_{0.0098}$</td>
    </tr>
    <tr>
        <td>el_zero</td>
        <td>$0.0013$</td>
        <td>$^{-0.0007}_{0.0006}$</td>
        <td>$^{0.0000}_{-0.0000}$</td>
    </tr>
    <tr>
        <th>Total</th>
        <th></th>
        <td>$\pm 0.0011$</td>
        <td>$\pm 0.0247$</td>
    </tr>

</table>

        <figcaption>
            Table of possible sources of systematics and their propogated errors.
        </figcaption>
    </figure>




</section>
<!--
<section>
    <h2>Source Parameters 2017</h2>

    <h3>Results</h3>

    <h3>Data</h3>

</section>

<section>
    <h2>Mirror Parameters 2018</h2>

    <h3>Results</h3>

    <h3>Data</h3>

</section>
-->

<hr>

<section>

    <h3>Notes</h3>
    <div class="footnote"><p>
        <sup>[<a name="ftn1" href="#sup1">1</a>]</sup>
        Using the max amplitude impinges an uncertainty on the beam centers which is half of the sample spacing for a given coordinate. In instrument-fixed coordinates, this corresponds to a median beam center uncertainty of $\sigma\sim0.05^\circ$ which is comparable to the quoted errors on the CMB-derived beam centers (median $\sigma\sim0.01^\circ$).
    </p></div>
    <h3>Code</h3>

<ul>
<li><tt>code1.py</tt> - Code desciption
</ul>



        <p id="demo"></p>

        <script>
            document.getElementById("demo").innerHTML =
                "The full URL of this page is:<br>" + window.location.href;
        </script>

        <h3>References</h3>
    <p id="testp"></p>
<p id="references"></p>
	<script type="text/javascript">

	// This my way of making shorthand links.
	// We'll make a couple arrays with the 'tag' and href information
	// and then look through each anchor element for the specified tag.
	// The anchors should then just look like: <a href="tagname"></a>
	// and the script will automatically fill in the hyperlings and text.


    var posting_log = "bkcmb"; // Which logbook is this posting going in?

    var posting_dir = window.location.href; // What's the current url?

    //var personal_log = "jcornelison/postings/"; // Do you have a personal logbook directory?
    var personal_log = "Documents/GitHub";
    var bkurl = "bicep.rc.fas.harvard.edu";
    var spurl = "bicep.usap.gov";


    // Logbook Site map:
    // personal:www/jcornelison/postings/
    // bkcmb:   www/bkcmb/analysis_logbook/analysis/
    // keck:    www/keck/analysis_logbook/analysis/
    // BICEP3:  www/bicep3/analysis_logbook/
    // BA:      www/bicep_array/analysis_logbook/


    // Shorthand tags
    var tags = [
        "CAB2012",
        "IDB2013",
        "CAB2014",
        "RWO2015",
        "JBW2018",
        "JAC2019"
	];


    // Links
	var hrefs = [
        "../../../../keck/analysis_logbook/analysis/20120510_beam_map_pointing/",
        "../20131005_sidelobe_coordinates/sidelobe_coordinates.pdf",
        "../../../../keck/analysis_logbook/analysis/20140203_beam_map_pointing/",
        "http://polar-array.stanford.edu/twiki/bin/view/BICEP3/Logbook150205RadioPointing",
        "../20181207_B2018_beamcen/",
        "../20190409_moon_analysis_2017/"
	];

    // Links
    var hrefs = [
        "keck/analysis_logbook/analysis/20120510_beam_map_pointing/",
        "bkcmb/analysis_logbook/analysis/20131005_sidelobe_coordinates/sidelobe_coordinates.pdf",
        "keck/analysis_logbook/analysis/20140203_beam_map_pointing/",
        "http://polar-array.stanford.edu/twiki/bin/view/BICEP3/Logbook150205RadioPointing",
        "bkcmb/analysis_logbook/analysis/20181207_B2018_beamcen/",
        "bkcmb/analysis_logbook/analysis/20190409_moon_analysis_2017/"
    ];


	// Posting titles
	var desc = [
        "Pointing Model for Keck Beam Maps",
        "Calculations for Beam Mapping in Spherical Coordinates",
        "Spherical Coordinates for beam maps",
        "Radio pointing model from CMB",
        "B2016, B2017, and B2018 CMB-derived beam center correlations",
        "Analysis of Jan 2017 BICEP3 DK=0 Moon observations for RPS"
	];

    var posty = document.getElementById("testp");
    //var msg = "";

    compstr = posting_dir.match(new RegExp("/"+personal_log+"/"));
    posty.innerHTML = compstr;


    // Depending on where you are, go back to the www directory
    // then go directly to the posting.
    // for (var ref in hrefs){
    //     // Are we in our own directory?
    //
    // }




	// Make a list of references
	var post = document.getElementById("references");
	var msg = "<table>";
	for (var tag in tags){
		msg = msg + "<tr><td><a href="+hrefs[tag]+">"+tags[tag]+"</a></td><td> - </td><td>"+desc[tag]+"</td>";
	};
	msg = msg+ "</table>";
	post.innerHTML = msg;

	// Look through all the hyperlinks and insert the proper links to the postings
	var links = document.getElementsByTagName("A");
	for (var link in links){
		for (var tag in tags){
			if (links[link].href.endsWith(tags[tag])){
				links[link].text = "("+tags[tag]+")";
				links[link].href = hrefs[tag];
				links[link].target = "_blank";
			}
		}
	}
	
	</script>
</section>
</body>
