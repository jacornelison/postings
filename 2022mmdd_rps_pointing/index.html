<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>2022 RPS Analysis I — J. Cornelison</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript"
            src="../mathjax/MathJax.js?config=TeX-AMS-MML_SVG">
    <!--            src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">-->
    </script>

</head>

<body>
<!-- Add my custom pager script -->
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

<header>
    <h1>2022 RPS Analysis I: Observations and Pointing Systematics</h1>

    <time datetime="2020-xx-xx" class="published updated">
        yyyy Mmm dd
    </time> —
    J. Cornelison
</header>

<hr>

<p>
    This posting is the first in a series of postings which covers the analysis of the observations of the RPS taken in January 2022.
    In this posting I briefly discuss the details of the RPS observations, give an overview of the RPS analysis, and then I conduct an investigation of possible sources of systematic uncertainty on polarization angles from the pointing model. In my previous posting <a href="JAC2022c"></a>, which performs a similar analysis using Moon data, we saw evidence of the Sun affecting the apparent scaling of the focal plane due to the Sun's location with respect to the mirror which is independently confirmed by the RPS data. In addition, I find strong evidence in both Moon and RPS data that applying a single mirror parameter can impinge a bias on the apparent orientation of the focal plane up to 0.1&deg;. The data also shows however that we have sufficient constraining power on the mirror orientation at the rasterset level that we can effectively mitigate any such bias. Because the scaling affects the pointing and thus the projection of polarization in turn, I plan to also fit a scaling parameter at the rasterset level.

</p>
<p>
    Lastly, I find that cutting any of the Moon data when calculating the mirror orientation impinges a bias on the focal plane orientation angle up to 0.02&deg;. As such, we are able to use the geometric relationship between the mirror and the source to establish a tighter constraint on the FPU orientation angle than simply propagating the error on the mirror orientation derived from the Moon data.
    With all of these factors accounted for, the uncertainty on the focal plane orientation is given by the intrinsic scatter of the measurement and our ability to detect a bias on the focal plane angle from errors in the mirror and source parameters: &sigma;=&pm;0.03&deg;(stat)&pm;0.005&deg;(sys)
</p>

<hr>
<!--16 Aug 2022-->
<section>
    <h2>RPS Observations</h2>
<p>
    We acquire beam maps of a given detector by scanning over the RPS in 9&deg;Az&times;2&deg;El rasters at 1.5&deg;/s in Az and 0.1&deg; steps in El -- all with the RPS fixed at a given angle WRT gravity.
    We get modulation curves by completing multiple rasters over the same part of the focal plane with the RPS commanded to a different angle for each raster, which we call a rasterset.
    Each rasterset includes 13 rasters with the RPS rotated from -180&deg; to 180&deg; in 30&deg; increments and takes about 40 minutes to complete -- compare to a full Moon schedule which takes a roughly an hour.
    A typical RPS schedule run by GCP consists of 19 rastersets where the first rasterset starts with an El offset of -12.5&deg; and steps in 1.5&deg; between each rasterset to ensure there are no gaps in coverage over the focal plane [see Fig. 1.1 of <a href="JAC2022a"></a> for an example].
    In this posting, I'll typically refer to the Moon and RPS data in terms of rasters, rastersets, or observations. Each observation typically consists of 3 schedules and generally maps beams across the entire focal plane at a single DK angle.
</p>

    <p>
        Aside from the main suite of science-grade RPS schedules, we also completed a number of cross check schedules. These schedules are mostly identical to the our main schedules except we adjust one or two parameters depending on the particular systematics we want to probe. We categorize the schedules by their schedule number where the most recent RPS science schedule is Type-5 and proceeding schedule types denote cross-check schedules<sup><a name="sup1" href="#ftn1">[1]</a></sup>. A list of the observations we collected in Jan 2022, their schedule types and their uses is shown in Table 1.1.
    </p>


    <figure class="table">
        <table class="center results">
            <tr>
                <th colspan="1">Schedule Type</th>
                <th colspan="1">Obs. Length (Hrs.)</th>
                <th colspan="1">Total Time (Hrs.)</th>
                <th colspan="1">Adjusted Parameter</th>
                <th colspan="1">Systematics Probed</th>
            </tr>
            <tr>
                <td>5</td>
                <td>13.5</td>
                <td>420.4</td>
                <td>None</td>
                <td>Standard RPS Observations</td>
            </tr>
            <tr>
                <td>6</td>
                <td>13.6</td>
                <td>13.6</td>
                <td>RPS angle -180 to 180 Minus DK angle</td>
                <td>Importance of nulling mod curve</td>
            </tr>
            <tr>
                <td>7</td>
                <td>1</td>
                <td>70.7</td>
                <td>Target Moon, only one raster</td>
                <td>Standard Moon Observations</td>
            </tr>
            <tr>
                <td>8</td>
                <td>0.1</td>
                <td>0.5</td>
                <td>No Mount Movement</td>
                <td>Rotation stage operational checks</td>
            </tr>
            <tr>
                <td>9</td>
                <td>0.5</td>
                <td>22.9</td>
                <td>Quick-turnaround 1&deg;&times;1&deg; single-pair map</td>
                <td>System stability</td>
            </tr>
            <tr>
                <td>9.1</td>
                <td>0.3</td>
                <td>3.5</td>
                <td>1&deg;&times;1&deg; map, 45&deg; increments</td>
                <td>&sigma;-Angle vs. Mod Curve Samples</td>
            </tr>
            <tr>
                <td>9.2</td>
                <td>1.1</td>
                <td>11.0</td>
                <td>1&deg;&times;1&deg; map, 10&deg; increments</td>
                <td>&sigma;-Angle vs. Mod Curve Samples</td>
            </tr>
            <tr>
                <td>9.3</td>
                <td>0.5</td>
                <td>4.6</td>
                <td>1&deg;&times;1&deg; map, No Homing between obs.</td>
                <td>RPS homing precision</td>
            </tr>
            <tr>
                <td>10</td>
                <td>3.1</td>
                <td>9.2</td>
                <td>RPS fixed & boresight rotated instead</td>
                <td>Pointing model validation</td>
            </tr>
            <tr>
                <td>11</td>
                <td>3.2</td>
                <td>9.2</td>
                <td>Rasters 27&deg; in Az</td>
                <td>Short- & long-timescale mirror deformation</td>
            </tr>

        </table>
        <figcaption>

        </figcaption>
    </figure>

<p>
    My last few postings on the Moon analysis used only the Type-7 data. This posting mostly focuses on the Type-5 main RPS data, but I will also look into the Type-10 and Type-11 cross-check data.
</p>

    <h3>RPS Analysis in a nutshell</h3>

    <p>
        The general approach to converting the RPS data to estimations on the polarization angles and cross-polar response of a given detector is to done in two parts: fit 2D Gaussians to a rasterstet to derive the amplitudes of a modulation curve and then fit a sinusoidal function to the modulation curve to derive the polarization angle and cross-polar response (see Figure 1.1 below).
    </p>

    <figure>
        <img src="figs\spie_mod_curve.png"/>
        <figcaption>

        </figcaption>
    </figure>


    <p>The Gaussian we fit is done at the timestream level in raw mount coordinates <a href="KWY2007"></a> and is of the form:</p>

    \begin{equation}
    B(\mathbf{x}) = A e^{(\mathbf{x}-\mathbf{\mu})^T\Sigma^{-1}(\mathbf{x}-\mathbf{\mu})}
    \end{equation}
    Where $A$ is the amplitude, $\mathbf{\mu} = (Az_0\,\,El_0)$ is the beam centroid, and

    \begin{equation}
    \Sigma =
    \begin{bmatrix} \sigma_{Az}^2& \rho \sigma_{Az} \sigma_{El} \\ \rho \sigma_{Az} \sigma_{El} & \sigma_{El}^2 \end{bmatrix}
    \end{equation}

    <p>
    where $(\sigma_{Az},\,\sigma_{El})$ is the beam width, and $\rho$ is the beam ellipticity. The significant difference between this analysis and other analyses involving beams is that we include 13 amplitude parameters to account for each beam in the modulation curve while fitting only a single $Az_0$, $El_0$, $\sigma_{Az}$, $\sigma_{El}$, and $\rho$ parameter across all the beams in a rasterset. This is to mitigate pointing effects from the Roger Effect <a href="RWO2013"></a> and to allow good beam centroid fits for rasters during which the RPS angle is orthogonal to a given detector and the SNR on the beam amplitude is low.
    </p>

    <p>Once we have our modulation curve, we could fit a sinusoidal function of the form:</p>

    \begin{equation}\label{eq:modcurve}
    A(\theta) = G\left(\cos\left(2\left(\theta+\psi\right)\right)-\frac{\epsilon+1}{\epsilon-1}\right)\left(n_1\cos(\theta)+n_2\sin(\theta)+1\right)
    \end{equation}
    <p>
        where $G$ is the detector gain, $\theta$ is the RPS angle WRT gravity, $\psi$ is the detector polarization angle with respect to the source, $\epsilon$
        is the detector cross-polar response, and ($n_1,\,n_2$) are nuisance parameters to account for miscollimation of the source rotation axis.
    </p>
    <p>
        The polarization angle $\psi$ in Equation \ref{eq:modcurve} is a relative measurement and is agnostic to the orientation of the focal plane.
        We define an angle $\phi_d$, which is the polarization angle of a detector with respect to the focal plane, by combining $\psi$ with the angle between the telescope's focal plane orientation and the RPS's orientation, called $\phi_s$, which is computed through the pointing model <a href="JAC2019"></a>.
    </p>
    \begin{equation}
    \phi_d = \psi + \phi_s
    \end{equation}

    <p>In application, $\phi_s$ is computed for at every RPS angle to account for any polarization projection effects from the mirror<sup><a name="sup2" href="#ftn2">[2]</a></sup>:</p>


    \begin{equation}\label{eq:modcurve2}
    A(\theta) = G\left(\cos\left(2\left(\theta+\psi+\phi_s\right)\right)-\frac{\epsilon+1}{\epsilon-1}\right)\left(n_1\cos(\theta+\phi_s)+n_2\sin(\theta+\phi_s)+1\right)
    \end{equation}

    <p>This way, the angle we estimate from the modulation curve is automatically given as $\phi_d$.</p>

<p>
    Because this $\phi_s$ term tracks the focal plane orientation, it is sensitive to the inputs of the pointing model. As such, the rest of this posting is dedicated to characterizing possible sources of systematics on the focal plane orientation and establishing a constraint on the total uncertainty of $\phi_s$.
</p>

</section>

<section><h2>Mirror/Source Systematics</h2>


    <h3>Estimating RPS Location</h3>


<p>We have a general idea of where the RPS is located on the sky, but we constrain it to a high degree by locking in the mirror orientation from Moon data and then, knowing all other inputs of our pointing model, estimate the location of the source by comparing our RPS-derived beams to our fiducial CMB-derived beams.
    I use the mirror parameters derived from the Moon Analysis described in <a href="JAC2022c">JAC2022c</a> and fit for a source location to the Type-5 Main RPS data over all DK angles using a method similar to how we fit for mirror parameters described in &sect;2 of <a href="JAC2022a"></a> except we take the mirror parameters in the pointing model as known and instead let the source azimuth and elevation be free parameters:</p>
    <p>With <tt>beam_map_pointing_model.m</tt> as our
        model we computer the instrument-fixed coordinates in x/y <a href="JAC2021"></a>:</p>

    \begin{equation}
    \label{bmpm}
    [x,\,y,\,\phi] = \text{beam_map_pointing_model}(Az_{src},\,El_{src} | A_{0},\,E_{0},\,K_{0},\,Mount,\,Mirror)
    \end{equation}

    where $A_0$, $E_0$, and $D_0$ are the as-fit beam centers in raw mount coordinates; $Mount$ comprises the relevant
    mount information derived from both optical starpointing and Solidworks drawings; $Mirror$ comprises the tilt, roll and height of the mirror.

    <p>Then using CMB-derived beam centers as the 'observed' quantity, the chi-square to minimize is just:</p>

    \begin{equation}
    \label{sourcechi2}
    \chi^2=\sum \frac{(x_{CMB,i}-x_{0,i})^2+(y_{CMB,i}-y_{0,i})^2}{\sigma_i^2}
    \end{equation}

    <h3>FPU Scaling and orientation</h3>
    <p>
        The pointing model assumes a perfectly flat, rigid mirror. I track any deviations from these assumptions using four additional parameters that affect the focal plane globally: Angle, Scaling, X-Translation, and Y-translation. After converting from raw mount coordinates to instrument-fixed $x,\,y$, I apply these terms as follows:
    </p>

    \begin{equation}
    \begin{split}
    x &= B\left[\;\left(x_{0}+x_t\right)\cos\zeta-\left(y_{0}+y_t\right)\sin\zeta\;\right]\\
    y &= B\left[\;\left(x_{0}+x_t\right)\sin\zeta+\left(y_{0}+y_t\right)\cos\zeta\;\right]\\
    \end{split}
    \end{equation}

    <p>
    where $\zeta$ is the rotation angle, $B$ is the scaling, and $x_t,\,y_t$ are the x/y translations.
    I minimize the same chi-square Eq. \ref{sourcechi2} to estimate these terms.
    </p>

    <h3>Beam Center Residuals</h3>
    <p>
        The pager below shows the residuals between the CMB-derived and RPS-derived best-fit beam centroids. The quivers are color-coded by the chronological order of the rastersets where blue is the earliest and red is the latest.
    </p>

    <ul>
        <li>
            <b>Obs DK</b> - Observations, denoted by the DK at which they were taken, in chronological order.
        </li>
        <li><b>Mirror Tilt/Roll Overall</b> - From <a href="JAC2022c">JAC2022c</a>, we have evidence that the mirror is physically moving from measurement-to-measurement, so after fitting an overall source position I keep the source fixed and fit for the mirror parameters per-observation for the <i>Per-Obs</i> option. For the <i>Overall</i> option, I leave the mirror parameters fixed at Tilt=44.88&deg;/Roll=-0.07&deg;.
        </li>
        <li>
            <b>Correction</b> - These options apply the best-fit angle/scaling/translation parameters described in &sect;2.2 to the RPS-derived beam centroids before plotting.
        </li>
        <li>
            <b>Coord</b> - Choose between an instrument-fixed or a quasi-mirror-fixed coordinate system which is calculated by derotating the DK angle at which the observation was done.
        </li>
    </ul>

        <p></p>
        <figure>
            <img alt="Name pager" id="quiverpager" src="#" />
            <figcaption>

            </figcaption>
            <script type="text/javascript">
                function fcn(params){
                        return 'figs/quiver_dk'+params.dk+'_fit_'+params.fit+params.coord+'_'+params.corr+'_rps.png';
                }

                pager.link("#quiverpager",
                    {
                        'Obs DK|dk' : ['0','61','23','174','68_1','-81','90','45','135','68_2'],//, '0_1', '0_2','90_2','90_3','-68','-23'],
                        'Mirror Tilt/Roll Fit|fit' : ['Overall|overall','Per-Obs|perobs'],
                            'Correction|corr': ['None|none','Angle|ang','scale','xtrans','ytrans','all'],
                        'Coord|coord' : ['Inst Fixed|','Mirror Fixed|_mirror'],
                     },
                fcn);
                pager.setparams({
                    'fit': 'overall',
                    'dk' : '68_1',
                    'corr': 'none',
                    'coord': '',
                });
            </script>
            </figure>

    <p>
        As I mentioned in &sect;1, a single RPS rasterset takes almost the same amount of time as a whole Moon schedule. That we see such high variation in the quivers across the focal plane isn't particularly surprising because we saw a relatively large variation in the Moon data from observation-to-observation. Because the variance is so high, it is hard to say by eye that fitting the mirror parameters per-observation reduces the residuals. I think this is also true for the global FPU parameters with the exception of the scaling which appears to reduce the residuals for all but one or two observations. In the following section, however, we can see more clearly that it's possible to track the mirror fluctuations not only on the per-obs level, but even the per-rasterset level.
    </p>


    <h3>Probing Pointing Systematics</h3>


    <p>I check for possible correlations in the mirror and FPU parameters in the pager in Figure 2.2.. The pager plots the mirror tilt and roll along with the overall FPU angle and scaling fits as a function of multiple different variables. The data are color-coded by the chronological order in which the observations were taken.</p>


    <ul>
        <li>
            <b>Y-Axis</b> - Dependent variable. FPU Angle/Scale overall uses a fixed parameter for the mirror location whereas FPU Angle/Scale per obs uses the per-obs (or per-rastersets) fits for the mirror when calculating x/y coordinates to derive the angle/scaling.
        </li>
        <li>
            <b>X-Axis</b> - Independent variable. $x_m$, $y_m$ and $\theta_m$ are the beam centeroids with the DK-angle derotated to get us into a quasi-mirror-fixed coordinate system -- $x_m$ is showing trends along the Mirror Roll, $y_m$ shows trends along Mirror Tilt, and $\theta_m$ probes any directional trends. The tiltmeter values are the tilt readout at the start of the obs or rasterset and so only make sense for the per-rasterset click.
        </li>
        <li>
            <b>Target</b> - Switch between Moon and RPS Main (Type 5) data.
        </li>
        <li>
            <b>Resolution</b> - A data point represents either an entire observation or a single rasterset (or just raster for the Moon data) within that observation. I included this option because while the Moon observations only take 3 hours, the RPS observations take ~39 hours to complete and thus any diurnal effects would be washed out. RPS rastersets take ~40 minutes to complete which are much more close in time resolution to the Moon data we compare to. Whereas each data point in the <i>per-obs</i> option represents the average of all of the detectors for the whole focal plane, each datapoint in the <i>per-rasterset</i> represents the average of all of the detectors in just a 9&deg;Az&times;2&deg;El area on the focal plane.
        </li>
        <li>
            <b>Moon Data Cut</b> - Use mirror parameters from <a href="JAC2022c">JAC2022c</a> Table 2.2 for computing the source location in the RPS analysis: without the <i>Early</i> data (Nov30-Dec6) or <i>Late</i> data (Dec9-Jan26) -- the late data cut uses Tilt=44.88 Roll=-0.09.
        </li>

    </ul>

    <figure>
        <img alt="Maps pager" id="versuspager" src="#" width="100%"/>
        <figcaption>

        </figcaption>
        <script type="text/javascript">
            pager.link("#versuspager",
                {
                    'Y-Axis|param' : ['Tilt|tilt','Roll|roll','FPU Angle Overall|fpu_ang','FPU Scale Overall|fpu_scale','FPU Angle per obs|fpu_ang_obs','FPU Scale per obs|fpu_scale_obs'],
                    'X-Axis|x' : ['Time|t','Time-of-day|tod','DK|dk','Sun-Src El|sun_els','Sun-Src Az|sun_azs','Mirror Tilt|tilt','Mirror Roll|roll','$x$|x','$y$|y','$r$|r','$\\theta$|theta','$x_m$|xm','$y_m$|ym','$\\theta_m$|thm','tiltmeter'],
                    'Target|tgt': ['Moon|moon','RPS|rps'],
                    'Resolution|res': ['per-obs|perobs','per-rasterset|perscan'],
                    'Moon Data Cut|cut': ['Off|_nocut', 'Early|_earlycut','Late|_latecut'],
                },

                function(params) {
                    return 'figs/'+params.param+'_vs_'+params.x+'_'+params.tgt+'_'+params.res+params.cut+'.png';
                });
            pager.setparams({
                'param': 'tilt',
                'x': 't',
                'tgt': 'moon',
                'res': 'perobs',
                'cut': '_nocut',
            });
        </script>
    </figure>

    <p>Important clicks:</p>
    <ol>
        <li>
            <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_scale_obs','x': 'sun_azs','tgt': 'moon','res':'perobs'})">Moon</a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_scale_obs','x': 'sun_azs','tgt': 'rps','res':'perscan'})">RPS</a> Scaling vs. Sun-Target Azimuth: We saw some indication in the Moon data that the scaling of the mirror was affected by the location of the Sun with respect to the mirror pointing. If you squint real hard at the RPS data, you can convince yourself of a slight dip in the scaling around -25&deg;, but it's hard to say anything definitive here.

        </li>
        <li>
            <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang','x': 'roll','tgt': 'rps','res':'perscan'})">Angle Overall vs. Roll</a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 'roll','tgt': 'rps','res':'perscan'})">Angle Per-Obs vs. Roll</a>:
            We can draw the same conclusion that we did from the Moon data <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang','x': 'roll','tgt': 'moon','res':'perobs'})">Overall</a> vs. <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 'roll','tgt': 'moon','res':'perobs'})">Per-Obs</a> -- Using an overall fit induces an apparent rotation on the focal plane indicating the changes in Roll are real.
        </li>


        <li>
            <a href="javascript:void(0)" onclick="pager.setparams({'param': 'roll','x': 'thm','tgt': 'moon','res':'perscan'})">Moon Roll vs. $\theta_m$</a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'roll','x': 'thm','tgt': 'rps','res':'perscan'})">RPS Roll vs. $\theta_m$</a>: We see structure in the Mirror Roll as a function of a mirror-fixed theta which appears relatively consistent between the Moon and RPS data (this is most easily seen when <a href="javascript:void(0)" onclick="pager.setparams({'cut':'_earlycut'})">Early</a> or <a href="javascript:void(0)" onclick="pager.setparams({'cut':'_latecut'})">Late</a> cut is turned on).
        </li>
        <li>
            <a href="javascript:void(0)" onclick="pager.setparams({'param': 'tilt','x': 'thm','tgt': 'moon','res':'perscan'})">Moon Tilt vs. $\theta_m$</a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'tilt','x': 'thm','tgt': 'rps','res':'perscan'})">RPS Tilt vs. $\theta_m$</a>: We see structure in the Mirror Tilt in mirror-fixed theta, but the features aren't as consistent between the Moon and RPS data as the Roll was.
        </li>

        <li>
            RPS Angle Vs. Time with <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 't','tgt': 'rps','res':'perscan','cut':'_latecut'})">Late</a>, <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 't','tgt': 'rps','res':'perscan','cut':'_nocut'})">Off</a>, and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 't','tgt': 'rps','res':'perscan','cut':'_earlycut'})">Early</a> cuts: The mean focal plane angle has a DC offset depending on which data is cut despite refitting the source location. Cutting the "Late" data, the mean per-rasterset angle is -0.02&deg;, No cut: 0&deg;, Early cut: 0.02&deg; all with a 1&sigma; STD of 0.08&deg; and an error-on-the-mean of 0.005&deg;.
        </li>
        <li>
            <a href="javascript:void(0)" onclick="pager.setparams({'param': 'roll','x': 'tiltmeter','tgt': 'rps','res':'perscan'})">RPS Roll vs. Tiltmeter</a>: There's no obvious dependence in Mirror Roll on the tiltmeter which provides more evidence that the RPS isn't moving in Azimuth to any significant degree.
        </li>
    </ol>

<p>
    Before drawing any strong conclusions from the information here, I put the Type-11 cross-check data through the same analysis as was done in this section in order to provide an extra independent cross-check of the instrumental effects that we see.
</p>

    <h3>Comparing to Type-11 data</h3>
    <p>

        The primary difference between Type-5 and Type-11 data is that, for each raster, we perform three 9&deg;Az&times;2&deg;El scans where the first scan is offset in Az by -13&deg;, the second by -4.5&deg;Az, and the third by 4&deg;Az.
        This ensures that we're mapping beams at each end of the focal plane (and thus the mirror) and allows us to trace systematics from one side of the mirror to the other on a shorter timescale. For comparison, the moon data samples one end of the mirror to the other along the Roll axis in roughly 2 hours, the Type-5 RPS data does the same in roughly 26 hours, and the Type-11 RPS data does this in about 40 minutes.
    </p>

    <p>
        The pager below shows the quiver plots of the Type-11 data with the same options as in Fig 2.1. Because we were short on time at this point, the Type-11 schedules only covered a small portion of the focal plane in elevation, but the data quality here is still quite good.
    </p>

    <figure>
        <img alt="Name pager" id="quiver2pager" src="#" />
        <figcaption>

        </figcaption>
        <script type="text/javascript">
            function fcn(params){
                return 'figs/quiver_dk'+params.dk2+'_fit_'+params.fit+params.coord+'_'+params.corr+'_rps11.png';
            }

            pager.link("#quiver2pager",
                {
                    'Obs DK|dk2' : ['0_1','0_2','90_1','90_2','-68','-23'],//, '0_1', '0_2','90_2','90_3','-68','-23'],
                    'Mirror Tilt/Roll Fit|fit' : ['Overall|overall','Per-Obs|perobs'],
                    'Correction|corr': ['None|none','Angle|ang','scale','xtrans','ytrans','all'],
                    'Coord|coord' : ['Inst Fixed|','Mirror Fixed|_mirror'],
                },
                fcn);
            pager.setparams({
                'fit': 'overall',
                'dk2' : '0_1',
                'corr': 'none',
                'coord': '',
            });
        </script>
    </figure>

    <p>
        We show figure 2.2 again, but this time with the Type-11 data included and it reinforces many of the points that we made in the previous section.
    </p>

    <figure>
        <img alt="Maps pager" id="versuspager2" src="#" width="100%"/>
        <figcaption>

        </figcaption>
        <script type="text/javascript">
            pager.link("#versuspager2",
                {
                    'Y-Axis|param' : ['Tilt|tilt','Roll|roll','FPU Angle Overall|fpu_ang','FPU Scale Overall|fpu_scale','FPU Angle per obs|fpu_ang_obs','FPU Scale per obs|fpu_scale_obs'],
                    'X-Axis|x' : ['Time|t','Time-of-day|tod','DK|dk','Sun-Src El|sun_els','Sun-Src Az|sun_azs','Mirror Tilt|tilt','Mirror Roll|roll','$x$|x','$y$|y','$r$|r','$\\theta$|theta','$x_m$|xm','$y_m$|ym','$\\theta_m$|thm','tiltmeter'],
                    'Target|tgt2': ['Moon|moon','RPS Type-5|rps' ,'RPS Type-11|rps11'],
                    'Resolution|res': ['per-obs|perobs','per-rasterset|perscan'],
                    'Moon Data Cut|cut': ['Off|_nocut', 'Early|_earlycut','Late|_latecut'],
                },

                function(params) {
                    return 'figs/'+params.param+'_vs_'+params.x+'_'+params.tgt2+'_'+params.res+params.cut+'.png';
                });
            pager.setparams({
                'param': 'fpu_scale_obs',
                'x': 'sun_azs',
                'tgt2': 'rps11',
                'res': 'perscan',
                'cut': '_nocut',
            });
        </script>
    </figure>
Important links:
    <ol>
        <li>
            <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_scale_obs','x': 'sun_azs','tgt2': 'moon','res':'perobs','cut':'_nocut'})">Moon</a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_scale_obs','x': 'sun_azs','tgt2': 'rps','res':'perscan'})">Type-5 RPS</a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_scale_obs','x': 'sun_azs','tgt2': 'rps11','res':'perscan'})">Type-11 RPS</a> Scaling vs. Sun-Target Azimuth: The scaling dependence on the mirror becomes readily apparent in the Type-11 data which is consistent with the Moon data. My guess is that the outliers are probably due to clouds obscuring the sun.
        </li>
        <li>
            <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang','x': 'roll','tgt': 'rps11','res':'perscan'})">Angle Overall vs. Roll</a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 'roll','tgt2': 'rps11','res':'perscan'})">Angle Per-Obs vs. Roll</a>:
            We can draw the same conclusion that we did from the Moon data <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang','x': 'roll','tgt2': 'moon','res':'perobs'})">Overall</a> vs. <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 'roll','tgt2': 'moon','res':'perobs'})">Per-Obs</a> -- Using an overall fit induces an apparent rotation on the focal plane indicating the changes in Roll are real.
        </li>


        <li>
            <a href="javascript:void(0)" onclick="pager.setparams({'param': 'roll','x': 'xm','tgt2': 'moon','res':'perscan'})">Moon</a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'roll','x': 'xm','tgt2': 'rps','res':'perscan'})">Type-5 RPS </a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'roll','x': 'xm','tgt2': 'rps11','res':'perscan'})">Type-11 RPS</a>  Roll vs. $x_m$: We have consistency across all three independent datasets of a dependence of Roll on the location of the mirror.
        </li>
        <li>
        <a href="javascript:void(0)" onclick="pager.setparams({'param': 'tilt','x': 'ym','tgt2': 'moon','res':'perscan'})">Moon</a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'tilt','x': 'ym','tgt2': 'rps','res':'perscan'})">Type-5 RPS </a> and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'tilt','x': 'ym','tgt2': 'rps11','res':'perscan'})">Type-11 RPS</a>  Tilt vs. $y_m$: There appear to be larger long-timescale drifts in the Tilt, but one could reasonably argue that the data are consistent here as well. This is more convincing when look at at this with <a href="javascript:void(0)" onclick="pager.setparams({'cut':'_earlycut'})">Early</a> or <a href="javascript:void(0)" onclick="pager.setparams({'cut':'_latecut'})">Late</a> cut turned on.
        </li>
        <li>
            Type-11 RPS Angle Vs. Time-of-Day with <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 'tod','tgt2': 'rps11','res':'perscan','cut':'_latecut'})">Late</a>, <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 'tod','tgt2': 'rps11','res':'perscan','cut':'_nocut'})">Off</a>, and <a href="javascript:void(0)" onclick="pager.setparams({'param': 'fpu_ang_obs','x': 'tod','tgt2': 'rps11','res':'perscan','cut':'_earlycut'})">Early</a> cuts: We also see a DC offset here depending on which Moon data is cut when computing the mirror parameters and determining the source location. Cutting the "Late" data, the mean angle (calculated per-rasterset) is 0&deg;, No cut: 0.03&deg;, Early cut: 0.04&deg; all with a STD of 0.07&deg; and an error-on-the-mean of 0.01&deg;.
        </li>
    </ol>

    <h3>Discussion and Conclusions</h3>
    <p>
        The Type-11 data served as an effective independent cross-check of the phenomena we're seeing in both the Moon and RPS data. We have confirmation of real deformation across the mirror on both short (~1hr) and long (~days) timescales and we have evidence that assuming a single mirror orientation for all observations can induce a bias in the apparent orientation of the focal plane. Both the Type-5 and Type-11 data suggest that we have sufficient constraining power on the mirror such that I can fit a mirror orientation to the RPS data on the rasterset level to avoid this FPU angle bias.
    </p>
    <p>
        In point 1, the Type-11 data confirms the scaling dependence on the Sun's location WRT to the mirror. Because this will affect the pointing and in turn the projection of polarization, we will need to fit for as scaling also when we estimate the mirror parameters. In addition, this also means that all of the Moon data will be included in calculating the overall mirror orientation when determining the source location and we can be confident that we're not impinging a bias on the FPU angle.
    </p>
    <p>
        Regarding the uncertainty of the FPU angle, I calculate upper limit on the statistical uncertainty by comparing the per-rasterset FPU angles between the two Type-11 observations at DK=0&deg; which were taken within a few hours of each other.
        The statistical uncertainty is given as the 1-&sigma; standard deviation of the difference between the two datasets divided by $\sqrt{2}$ which comes out to 0.03&deg;.
        From point 5 in both sections, the relationship between the mirror and source allows us to tighten our constraints to more than just an error propagation of the mirror uncertainty from the Moon data. So our systematic uncertainty comes down to our ability to determine if our FPU angle is significantly biased which is driven by the error on the mean FPU angle (0.005&deg;).
    </p>

    $$
    \sigma = \pm0.030^\circ\text{(stat)}\pm0.005^\circ\text{(sys)}
    $$



</section>


<hr>

<section class="appendix">
<h2 class="appendix">Appendix</h2>
    <h3>Footnotes</h3>
    <div class="footnote">
        <p>These are footnotes. Click the number to return to main text.</p>
        <p>
            <a name="ftn1" href="#sup1">[1]</a></sup>Example: a standard RPS schedule (type-5) at DK=0 is <tt>8_ffflat_rps_05_dk000_XXX.sch</tt> and a stability checking Type-9 schedule at DK=45 would be <tt>8_ffflat_rps_09_dk045_XXX.sch</tt> where <tt>XXX</tt> is the iteration number.
        </p>
        <p>
        <sup><a name="ftn2" href="#sup2">[2]</a></sup>This is strictly speaking in the geometrical sense. I plan to discuss differential reflection of polarization due to the fact that the mirror is aluminum in another posting.
    </p>
    </div>
    <h3>Code</h3>
    <p>Below is a list of code that was used for this analysis. The code is committed to the pipeline and can be found in the <tt>analysis/beammap/</tt> directory.</p>
    <p id="code"></p>

    <h3>Data</h3>
    <p id="data"></p>
    <h3>References</h3>

    <p id="references"></p>


    <p id="testp"></p>

    <script type="text/javascript">

        // Shorthand tags
        var codes = [
            "rps_fit_mirror_from_moon.m",
            ];

        // Posting titles
        var desc = [
            "Derives mirror parameters from observations of the moon.",

        ];

        // Make a list of references
        var post = document.getElementById("code");
        var msg = "<table class=\"code\">";
        for (var code in codes){
            msg = msg + "<tr><td><tt>"+codes[code]+"</tt></td><td> - </td><td>"+desc[code]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

    </script>

    <script type="text/javascript">

        // Shorthand tags
        var data = [
            "moonsch.mat",
            ];

        // Posting titles
        var desc = [
            "Metadata of Moon observations",
            ];

        // Make a list of references
        var post = document.getElementById("data");
        var msg = "<table class=\"code\">";
        for (var datum in data) {
            msg = msg + "<tr><td><tt>" + data[datum] + "</tt></td><td> - </td><td>" + desc[datum] + "</td>";
        }
        ;
        msg = msg + "</table>";
        post.innerHTML = msg;

    </script>



    <script type="text/javascript">

        // This my way of making shorthand links.
        // We'll make a couple arrays with the 'tag' and href information
        // and then look through each anchor element for the specified tag.
        // The anchors should then just look like: <a href="tagname"></a>
        // and the script will automatically fill in the hyperlings and text.


        var posting_dir = window.location.href; // What's the current url?

        var bkurl = "bicep.rc.fas.harvard.edu";
        var spurl = "bicep.usap.gov";

        // These are the possible places to find postings
        // The strings are for if you post your posting in that directory.
        var sitemap = {
            jcornelison: "../../../",   // /jcornelison/postings/
            bkcmb : "../../../../",     // /bkcmb/analysis_logbook/analysis/
            bicep3: "../../../",        //
            bicep_array: "../../../",   //
            bicep2: "",                 // We shouldn't be posting in these, but still have postings.
            keck  : "",                 // keck/analysis_logbook/analysis/
            spuder: "",                 // ~spuder/hieno_analysis_logboo
            bicep1: "",                 // ~bicep1/analysis_logbook_north/
            general_projects:"",
                   };
        // Logbook Site map:
        // personal:www/jcornelison/postings/
        // bkcmb:   www/bkcmb/analysis_logbook/analysis/
        // keck:    www/keck/analysis_logbook/analysis/
        // BICEP3:  www/bicep3/analysis_logbook/
        // BA:      www/bicep_array/analysis_logbook/
        // We shouldn't be posting in these, but still have postings.
        // bicep2:
        // keck:    www/keck/analysis_logbook/analysis/
        // spuder:  www/~spuder/hieno_analysis_logbook/
        // bicep1:  www/~bicep1/analysis_logbook_north/

        // Shorthand tags
        var tags = [
            "KWY2007",
            "CAB2012",
            "RWO2013",
            "JWB2018",
            "JAC2019",
            "JAC2021",
            "JAC2022a",
            "JAC2022b",
            "JAC2022c",
        ];

        // Links
        // Truncate the link down to the www directory in which is lies if you can.
        var hrefs = [
            "general_projects/rps/pointing_article.pdf",
            "keck/analysis_logbook/analysis/20120510_beam_map_pointing/",
            "bkcmb/analysis_logbook/analysis/20130205_polofs_model/",
            "bkcmb/analysis_logbook/analysis/20181207_B2018_beamcen/",
            "bkcmb/analysis_logbook/analysis/20190516_rps_pointing_defs/",
            "bkcmb/analysis_logbook/analysis/20210518_bmpm/",
            "bicep3/analysis_logbook/20220428_mirror_analysis/",
            "bicep3/analysis_logbook/20220505_mirror_analysis_2/",
            "bicep3/analysis_logbook/20220816_mirror_analysis_3/",
        ];


        // Posting titles
        var desc = [
            "BICEP Pointing Supplement",
            "Pointing Model for Keck Beam Maps",
            "Modeling Polarization-Dependent Beam Offsets",
            "B2016, B2017, and B2018 CMB-derived beam center correlations",
            "Pointing Model Definitions for Polarized Beam Mapping",
            "A New Pointing Model for Beam Mapping",
            "Deriving Mirror Properties from the Moon",
            "2022 Moon Analysis II: GCP Coordinate Systems and Moon Phases",
            "2022 Moon Analysis III: Moon Phase Correction and Mirror Systematics",

        ];
        // Debug
        var posty = document.getElementById("testp");


        var preface = "";
        var keys = Object.keys(sitemap);
        // If we're not at pole or bicep, just post the full URL
        // If we are, go back to the www directory.
        if (posting_dir.match(new RegExp(bkurl))!=bkurl &
            posting_dir.match(new RegExp(spurl))!=spurl){
                preface = "http://" + bkurl+"/";
            }
        else {
            for (key in keys){
                if (posting_dir.match(new RegExp("/"+keys[key]+"/"))=="/"+keys[key]+"/"){
                    preface = sitemap[keys[key]];
                };
            };

        };

        // Add the prefixes we can.
        // Only add prefixes to directories in the sitemap so we don't break
        // external references.
        for (ref in hrefs) {
            for (key in keys) {

            // If there's a match, at the prefix and move on.
            if(hrefs[ref].match(new RegExp(keys[key] + "/"))==keys[key]+"/"){
                hrefs[ref] = preface+hrefs[ref];
                break;
            }
            };
        };

        // posty.innerHTML = preface;

        // Make a list of references
        var post = document.getElementById("references");
        var msg = "<table>";
        for (var tag in tags){
            msg = msg + "<tr><td><a href="+tags[tag]+"></a></td><td> - </td><td>"+desc[tag]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

        // Look through all the hyperlinks and insert the proper links to the postings
        var links = document.getElementsByTagName("A");
        for (var link in links){
            for (var tag in tags){
                if (links[link].href.endsWith(tags[tag])){
                    links[link].text = "("+tags[tag]+")";
                    links[link].href = hrefs[tag];
                    links[link].target = "_blank";
                }
            }
        }

    </script>
</section>

<!--    <p>-->
<!--    I fit the detector beams over all the beam maps in a rasterset with one amplitude parameter per raster (usually 13) and with just  one parameter each for beam center, beam width, and correlation coefficient fit over all the beams in the rasterset. With RPS-derived beam centers, I fit for a source position using the mirror parameters given in <a href="JAC2022c"></a> per-DK.-->
<!--    </p>-->

<!--    <figure>-->

<!--        <img alt="Name pager" id="sourcepager" src="#" />-->
<!--        <figcaption>-->

<!--        </figcaption>-->
<!--        <script type="text/javascript">-->
<!--            pager.link("#sourcepager",-->
<!--                {-->
<!--                    'Param|parm': ['Az|az','El|el'],-->

<!--                },-->
<!--                function(params) {-->
<!--                    return 'figs/source_fit_'+params.parm+'.png';-->
<!--                });-->
<!--            pager.setparams({-->
<!--                'parm':'az',-->
<!--            });-->
<!--        </script>-->
<!--    </figure>-->

<!--    <p>As we expected from <a href="JAC2022c"></a>, we see fluctuations in the apparent source position over time. We expect this is actually due to the mirror deforming and not the source as we'd expect to see corresponding shifts in the tilt meter of $O(0.5^\circ)$, which we don't. Instead, what I've chosen to do is assume that the actual source position is the mean across all observations and then refit for the mirror orientation on per-DK and per-schedule bases. This step is important because it ensures we're properly accounting for the addition rotation of the focal plane induced by the mirror roll parameter.</p>-->

<!--    <p></p>-->

<!--    <figure>-->
<!--        <img alt="Name pager" id="mirrorpager" src="#" />-->
<!--        <figcaption>-->

<!--        </figcaption>-->
<!--        <script type="text/javascript">-->
<!--            pager.link("#mirrorpager",-->
<!--                {-->
<!--                    'Param|parm2': ['Tilt|tilt','Roll|roll'],-->

<!--                },-->
<!--                function(params) {-->
<!--                    return 'figs/mirror_fit_'+params.parm2+'.png';-->
<!--                });-->
<!--            pager.setparams({-->
<!--                'parm2':'roll',-->
<!--            });-->
<!--        </script>-->
<!--    </figure>-->

<!--    <p>The pager below shows quivers of beam-center residuals. </p>-->

<!--    <figure>-->
<!--        <img alt="Name pager" id="quiverpager" src="#" />-->
<!--        <figcaption>-->

<!--        </figcaption>-->
<!--        <script type="text/javascript">-->
<!--            pager.link("#quiverpager",-->
<!--                {-->
<!--                    '|parm3': ['Source|source','Mirror|mirror'],-->
<!--                    'Fit|fit' : ['perdk','persch'],-->
<!--                    'DK|dk' : ['61', '23','174','68_1','-81','90','45','135','68_2'],-->

<!--                },-->
<!--                function(params) {-->
<!--                    return 'figs/quiver_'+params.parm3+'_'+params.fit+'_dk_'+params.dk+'.png';-->
<!--                });-->
<!--            pager.setparams({-->
<!--                'parm3':'source',-->
<!--                'fit': 'perdk',-->
<!--                'dk' : '61'-->
<!--            });-->
<!--        </script>-->
<!--    </figure>-->


</body>
