<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Posting Title — J. Cornelison</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
	<script type="text/x-mathjax-config">
        MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript"
        src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>

<body>
<!-- Add my custom pager script -->
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

<header>
    <h1>Polarization Angles and Efficiencies on BICEP3</h1>

    <time datetime="2020-xx-xx" class="published updated">
        2020 Mmm dd
    </time> —
    J. Cornelison
</header>
<!--
<hr>

<p>Introduction summary paragraph.</p>

<ul>
    <li>Give a brief description of measurement and data</li>
    <li>What's the SNR?</li>
    <li>What's the repeatability?</li>
    <li>What data are you cutting?</li>
    <ul>
        <li>At single boresight angle</li>
        <li>At multiple boresights</li>
    </ul>
    <li>Open Threads</li>
    <ul>
        <li>"We have a really good understanding of the location and orientation of the RPS WRT to gravity and we have a really good understanding of the orientation of the telescope. To establish an absolute reference frame, we can connect the two by reconciling the position/orientation of the mirror by ... over our wide field of view</li>
    </ul>
</ul>
-->
<hr>

<section>
    <h2>Introduction</h2>
    <h3>Motivation</h3>
    <ol>
        <li>Adding a Chern-Simons term to the EM Lagrangian results in Uniform Cosmic Birefringence</li>
        <li>Means: the speed of circularly polarized light changes depending on pol. direction</li>
        <li>For linearly pol. light, polarization orientation rotates as it propogates</li>
        <li>We'll see larger rotation $\alpha$ the longer it propagates</li>
        <li>CMB is perfect for this sort of observation.</li>
        <li>$\alpha$ is degenerate with instrumental rotation $\Delta \phi$</li>
        <li>Constraining $\alpha$ requires calibrating the instrument rotation.</li>
        <li>Rich history of constraints on UCB, but we think we can do better (Table 1). </li>
    </ol>
    <figure>
        <img src="figs/table_1.PNG">
    </figure>
</section>


<section><h2>Far Field Polarization Measurements</h2>
    <h3>Setup</h3>
    <p>We map polarization response in the far-field using a Rotating Polarized Source (RPS) which is an electrically
        chopped, non-thermal, broad spectrum noise source (BSNS) fixed to a precision rotation stage and finely
        polarized using a wire grid.
        The RPS is deployed atop a 12m mast on the Martin A. Pomerantz Observatory and observed by BICEP3 in the Dark
        Sector Laboratory 211m away (The far-field of BICEP3 is $\sim180$m).
        Even atop the mast, the RPS is well below BICEP3's normal elevation range so a flat, beam-filling,
        aluminum-honeycomb mirror is installed at a $45^\circ$ tilt to redirect rays onto the horizon when the telescope
        is pointed at zenith.
        The forebaffle which during normal operation terminates the sidelobes is removed to accomodate the installation
        of the redirecting mirror.</p>

    <p>
        The RPS is housed within an environmental enclosure and PID temperature controlled to ensure stability on the
        output.
        The environmental enclosure is equipped with high-visibility tabs on each side to allow for precise alignment
        ($<1^\circ$) with the telescope.
        We reference the polarization orientation of the source to zenith using a precision tilt meter installed
        alongside the source within the environmental enclosure.
        The tilt of the source is zeroed and locked in using guy wires on the mast to which it is fixed.
        Because the horizon is thermally bright, the RPS is chopped at 20 Hz and demodulated during analysis to isolate
        the signal from the surrounding area.
    </p>
    <figure>
        <img src="figs/rps_figures.png">
        <figcaption>
            Images of a typical RPS setup.
            <b>Left:</b> RPS deployed atop a 40ft mast which is observed by reflecting rays off of an aluminum honeycomb flat mirror <b>(Middle-Left)</b>.
            <b>Middle-Right:</b> RPS benchtop setup - BBNS with absorptive shroud and wire grid secured to a precision rotation stage.
            <b>Right:</b> Zoomed image of the RPS installed in its environmental encloser shows alignment strips allows for precise pointing alignment ($<1^\circ$) with the telescope.
        </figcaption>
    </figure>
    <h3>Observations</h3>
<p>
    We capture the polarization coupling between the telescope and source by rotating the source over a full $360^\circ$ of rotation.
    With the RPS fixed at one polarization angle, we map polarized beams by rastering across the source $9^\circ$ in azimuth at $1.5^\circ/s$ and step up to $2^\circ$ in elevation in $0.1^\circ$ steps.
    A full RPS observation, called a rasterset, consists of 13 separate rasters where the RPS is commanded from $-180^\circ$ to $180^\circ$ in $30^\circ$ increments.
    This scan strategy allows us to sufficiently map the entire focal plane with multiple samples per beam over all source angles between cryogenic cycling.
    An example of the modulation curve as a function of RPS angle is shown in Fig. ??.
</p>
    <p>

        Rasters are have very high signal-to-noise with a median SNR of $\sim6000$ at maximum amplitude.
    </p>
<figure>
    <img src="figs/raster.png" width=50%>
    <figcaption>
        An example RPS raster.
        Rasters are $9^\circ \times 2^\circ$ in azimuth and elevation respectively with $0.1^\circ$ steps in elevation.
        Rasters are have very high signal-to-noise at the detector level with a median SNR of $\sim6000$ at maximum amplitude.
    </figcaption>
</figure>


    <figure>
        <table>
            <tr>
                <td><img src="figs/mosaic.png"/></td>
            </tr>
            <tr>
                <td><img src="figs/modcurve.png"/></td>
            </tr>
        </table>

        <figcaption>
            <b>Top:</b> Beam maps of individual RPS rasters from a rasterset for a single detector and resulting modulation curve as a function of source command angle <b>(bottom)</b>
        </figcaption>
    </figure>


    <p>

    </p>

<h3>Dataset</h3>
<p>
    The RPS observations used in this analysis were taken in January and February of 2018. Five observations were taken over four boresight angles of $1.25^\circ$, $46.25^\circ$, $91.25^\circ$, $136.25^\circ$ with and extra observation taken at $46.25^\circ$. The BICEP3 focal plane is clocked $1.25^\circ$ WRT the $DK=0^\circ$ and so we add $1.25^\circ$ to ensure maximum polarization coupling to the source. Observations over multiple boresight angles provides a consistency check of our measurement repeatability.
</p>



</section>

<section>
    <h2>Polarization Parameters</h2>
    <p>
        This section outlines the process through which we estimate polarization parameters.
        To summarize, for each detector we fit a 2-D elliptical Gaussian profile across all rasters in a rasterset
        simultaneously.
        The resulting amplitudes as a function of source angle are fit to polarization response model.
        Finally, the polarization parameters of the two orthogonal detectors corresponding to a single pixel are
        combined into a per-pixel polarization angle and cross-polarization response.
    </p>
    <p>
        We fit a 2-D elliptical Gaussian profile across all beams in a rasterset simultaneously where the beam amplitude
        $A$ is a free parameter for each raster but the beam center $(x_0\,\,y_0)$, beam widths $(\sigma_x,\,\sigma_y)$,
        and correlation coefficient $\rho$ are single parameters fit across the entire rasterset.
    \begin{equation}
    B_i(\mathbf{x}) = A_i e^{(\mathbf{x}-\mathbf{\mu})^T\Sigma^{-1}(\mathbf{x}-\mathbf{\mu})}
    \end{equation}
    Where $\mathbf{\mu} = (x_0\,\,y_0)$ is the beam center and
    \begin{equation}
    \Sigma =
    \begin{bmatrix} \sigma_x^2& \rho \sigma_x \sigma_y \\ \rho \sigma_x \sigma_y & \sigma_y^2 \end{bmatrix}
    \end{equation}
    
        This is to mitigate bad fits when the RPS and detector are $90^\circ$ out of phase and the constraining power on
        the beam is poor.
    </p>
    <p>
        The array of amplitudes $A$ resulting from the Gaussian fits produces a modulation curve as a function of source
        angle $\theta$.
        We fit a sinusoidal polarization response function to the modulation curves of the form
        \begin{equation}
        A(\theta) = G\left(\cos\left(2\left(\theta+\psi\right)\right)\right)\left(N_1\cos(\theta)+N_2\sin(\theta)\right)
        \end{equation}
        where $G$ is the gain of the detector, $\psi$ is the detector polarization angle with respect to the source,
        $\epsilon$ is the detector cross-polarization response, and ($N_1,\,N_2$) are nuisance parameters describing a
        miscollimation of the source rotation axis.
        We relate the detector polarization angle to the telescope zero $\phi$ by subtracting the polarization
        orientation of the source with respect to the telescope $\phi_s$
        \begin{equation}
        \phi_d = \psi - \phi_s
        \end{equation}
        which is computed through the pointing model described ...

        %\subsection{Per-pixel Polarization Parameters}
        Finally, we compute the polarization parameters of a pixel.
        For a pair of detectors A and B, the response in Stokes Q and U of the pixel is calculated as
        \begin{equation}\label{eq:QU}
        \begin{split}
        &Q =
        \frac{\left[\cos(2\phi_A)-\epsilon_A\cos(2\phi_A)\right]-\left[\cos(2\phi_B)-\epsilon_B\cos(2\phi_B)\right]}{2+\epsilon_A+\epsilon_B}\\
        &\\
        &U =
        \frac{\left[\sin(2\phi_A)-\epsilon_A\sin(2\phi_A)\right]-\left[\sin(2\phi_B)-\epsilon_B\sin(2\phi_B)\right]}{2+\epsilon_A+\epsilon_B}\\
        \end{split}
        \end{equation}

        and the effective per-pixel polarization angle $\phi_p$ and cross-polarization response $\epsilon_p$ is simply
        \begin{equation}\label{eq:phiq}
        \begin{split}
        &\phi_p = \frac{1}{2}\tan^{-1}\frac{U}{Q}\\
        &\\
        &\epsilon_p = 1-\sqrt{Q^2+U^2}
        \end{split}
        \end{equation}
    </p>
    <figure>
        <table>
            <tr>
                <td><img src="figs/diffhist_phip_corr.png"/></td>
                <td><img src="figs/diffhist_xpol.png"/></td>
            </tr>
        </table>

        <figcaption>
            Histograms of parameter estimates difference between observed boresight angles. We find the mean systematic repeatability between boresight angles $\sigma_{\phi_{pix}}<0.119^\circ$ and $\sigma_{\epsilon_{pix}}<0.0032^\circ$.
        </figcaption>
    </figure>

<p>

</p>

</section>

<section><h2>Results</h2>

    <figure>
        <table>
            <tr>
                <td><img src="figs/tile_plot_phip_corr.png"/></td>
                <td><img src="figs/tile_plot_phip_corr_medsub.png"/></td>
            </tr>
            <tr>
                <td><img src="figs/tile_plot_xpol.png"/></td>
                <td><img src="figs/tile_plot_xpol_medsub.png"/></td>
            </tr>
        </table>

        <figcaption>
            Per-polarization $\phi_{pix}$ and $\epsilon_{pix}$ across the focal plane.
        </figcaption>
    </figure>

    <figure>
        <table>
            <tr>
                <th>Statistics</th>
                <td>FPU Median Per-Tile</td>
                <td>FPU Scatter Per-Tile</td>
                <td>FPU Median Per-Pixel</td>
                <td>FPU Scatter Per-Pixel</td>
                <td>Statistical Uncertainty</td>
                <td>Systematic Uncertainty</td>
            </tr>
            <tr>
                <th>$\phi_{pix} (^\circ)$</th>
                <td>-1.20</td>
                <td>0.32</td>
                <td>-0.03</td>
                <td>0.13</td>
                <td>0.040</td>
                <td>0.119</td>

            </tr>
            <tr>
                <th>$\epsilon_{pix}$</th>
                <td>0.0069</td>
                <td>0.0097</td>
                <td>0.0016</td>
                <td>0.0084</td>
                <td>0.0014</td>
                <td>0.0032</td>
            </tr>

        </table>
    </figure>

</section>
<hr>


<section>
    <h2>Appendix: Extra Plots</h2>

    <h3>Cut Thresholds</h3>



    <figure>
        <img id="cutpager" src="#" />
        <figcaption>
            Cuts are performed to exclude outliers resulting from poor fits. Cut thresholds are kept "loose" to avoid cutting real statistical outliers. $\mathbf{\Delta x_0,\Delta y_0}$ : Deviations from fit beam centers and observed. $\mathbf{\Delta \epsilon,\Delta \phi}$ : Deviations of per-detector polarization parameters from expected values. <b>Fit:</b> Any fits that were flagged by the fitting function as "Failed" or "Problems" are cut. <b>SNR:</b> The Signal-to-Noise ratio is calculated by dividing the as-fit modulation curve amplitude by the STD of beam map noise floor.
        </figcaption>
        <script type="text/javascript">
            pager.link("#cutpager",
                {
                    'Parameter|p': ['$\\Delta x_0$|dx','$\\Delta y_0$|dy','$\\Delta \\epsilon$|xpol','$\\Delta \\phi$|phid','Fit|fit','SNR|snr'],
                },
                function(params) {
                    return 'figs/cutthresh_'+params.p+'.png';
                });
            pager.setparams({
                    'p': 'dx',
                });
        </script>
    </figure>




</section>

<section>
<h3>Code</h3>

<ul>
<li><tt>code1.py</tt> - Code desciption
</ul>


<h3>References</h3>
<p id="references"></p>
	<script type="text/javascript">
	// This my way of making shorthand links.
	// We'll make a couple arrays with the 'tag' and href information
	// and then look through each anchor element for the specified tag.
	// The anchors should then just look like: <a href="tagname"></a>
	// and the script will automatically fill in the hyperlings and text.
	var tags = [
	"CAB2012",
	"JB2016",
	"KLT2017",
	"KSK2018",
	"NWP2019",
	"FCG2-CH10",
	];
	
	// Logbook Site map:
    // bkcmb:   www/bkcmb/analysis_logbook/analysis/
    // keck:    www/keck/analysis_logbook/analysis/
    // BICEP3:  www/bicep3/analysis_logbook/
    // BA:      www/bicep_array/analysis_logbook/
	
	var hrefs = [
	"../../../../keck/analysis_logbook/analysis/20120510_beam_map_pointing/",
	"https://www.excamera.com/sphinx/article-ray.html",
	"../20170321_BA_Forebaf+GS_study01/",
	"../20181030_groundshield_study/",
	"../20190207_BA_Forebaffle_Concepts/",
	"http://www.cs.utah.edu/~shirley/books/fcg2/rt.pdf",
	];
	
	var desc = [
	"Pointing Model for Keck Beam Maps",
	"A reasonably speedy Python ray-tracer - James Bowman",
	"BA Forebaffle and Groundscreen Study 01: Zeroth Order Properties",
	"Probing Parameter Space of Ground Shield Design Dimensions for Double- and Triple-Shielded CMB Experiments",
	"BA Forebaffle Design Concepts",
	"Fundamentals of Computer Graphics 2nd Ed. - Peter Shirley",
	];
	
	
	var post = document.getElementById("references");
	var msg = "<table>";
	for (var tag in tags){
		msg = msg + "<tr><td><a href="+hrefs[tag]+">"+tags[tag]+"</a></td><td> - </td><td>"+desc[tag]+"</td>";
	};
	msg = msg+ "</table>";
	post.innerHTML = msg;

	var links = document.getElementsByTagName("A");
	for (var link in links){
		for (var tag in tags){
			if (links[link].href.endsWith(tags[tag])){
				links[link].text = "("+tags[tag]+")";
				links[link].href = hrefs[tag];
				links[link].target = "_blank";
			}
		}
	}
	
	</script>
</section>
</body>
