<!DOCTYPE html>

<!--suppress HtmlDeprecatedAttribute -->
<head>
    <meta charset="utf-8">
    <title>IPR: Unblinding Strategy</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript"
            src="../mathjax/MathJax.js?config=TeX-AMS-MML_SVG">
            // src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

</head>

<body>
<!-- Add my custom pager script -->
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

<header>
    <h1>Isotropic Polarization Rotation Analysis 8: Unblinding Strategy</h1>

    <time datetime="2023-06-13" class="published updated">
        2023 June 13
    </time> —
    J. Cornelison and C. Vergès
</header>

<hr>

<p>
    This posting is part of a series which comprises the IPR analysis on BICEP3, see <a href="#references">previous postings</a> for more on this. You can find a link to the paper here: <a href="IPRpaper"></a>.
</p>

<p>
    This posting covers our strategy for unblinding our isotropic birefringence analysis.
I first summarize the remaining threads that we need to close before unblinding can happen.
    I then go over the null tests and consistency checks we need to pass.
</p>
<p>
    I discuss two different ways at which we will look at results and I give an example of the plots we will use in each of these approaches. Finally, I go over detection criteria and what we'll do in the cases in which we do and don't significantly detect an excess polarisation rotation angle.
</p>

<hr>

<section>
    <h2>Questions that still need answers</h2>
    <p>
        Before we talk about looking at real data, we first need to finish filling out our uncertainty budget.
        The total uncertainty will comprise the stat/sys uncertainty from the CMB analysis (&sigma;<sub>CMB,stat</sub>, &sigma;<sub>CMB,sys</sub> resp.) and the sys/stat uncertainty from the instrumental calibration (&sigma;<sub>INST,stat</sub>, &sigma;<sub>INST,sys</sub> resp.) all added in quadrature:

        \begin{equation}
        \sigma^2_{tot} = \sigma^2_{CMB,stat}+\sigma^2_{CMB,sys}+\sigma^2_{INST,stat}+\sigma^2_{INST,sys}
        \end{equation}

    From <a href="JAC2023f"></a>, we have &sigma;<sub>CMB,stat</sub>=0.112&deg;(0.078&deg;) for 9(14) bandpowers.
        We still need to finalize the uncertainties for &sigma;<sub>CMB,sys</sub>, &sigma;<sub>INST,stat</sub>, and &sigma;<sub>INST,sys</sub>.

    </p>
    <p>
        Each of the threads listed here contributes to one of these error budgets and we need to have final estimates of those before we look at the birefringence angle.
    </p>

    <p>
        A link is provided if a draft posting exists for it already. Once these various threads are finalized, we will update with links to published postings.
        This list only addresses questions that we have already identified - as we finalize this analysis, it is of course possible that we encounter new questions that require more work. In that case, we will hold unblinding until we have resolved any issue we encounter.
    </p>

    <p><b>Instrumental Calibration</b></p>
    <ol>
        <li>
            What cross checks do we have on the calibration of the wire grid to gravity?
        </li>
        <ul><li>This is quantified through an in-lab measurement I did at pole and at Harvard last year. Draft Link: <a href="JAC2023h"></a></li></ul>

        <li>
            What cross checks do we have for tracking the orientation of the focal plane?
        </li>
            <ul>
                <li>This draft posting <a href="JAC2023i"></a> wraps up the systematics investigation into the pointing model in which we discuss the uncertainty on the FPU angle.</li>
            </ul>

        <li>
            What is the total uncertainty contribution to the birefringence angle from the instrumental calibration?
        </li>
        <ul>
            <li>I'm currently working on creating RPS signal (i.e. modulation curves) plus noise sims in order to derive the uncertainties from the instrumental calibration.
                I have been documenting this in my thesis, but it will ultimately be described in the paper.</li>
            <li>Included in this should be a summary of the error budget which is being developed in the Table 2 of the paper.<a href="IPRpaper"></a></li>
        </ul>
    </ol>
    <p><b>CMB Analysis</b></p>
    <ol>
        <li>What is the predicted impact on the birefringence angle bias/uncertainty from beam systematics?</li>
        <ul>
            <li>The plan here is to establish an upper limit by crossing beam sims with Type 8 and real sims and then fitting angles to them.</li>
            <li>Draft Link: <a href="CV2023b"></a></li></ul>
        <li>
            How certain are we that we've got the sign of the birefringence angle correct?
        </li>
        <ul>This requires reconciling theory with what we're actually doing in the code and so far I've only found one inconsistency.</ul>


    </ol>


    <p>
       For all of these threads, work is already well underway in most cases. Provided we don't encounter unanticipated difficulties in tying those off, we should be able to proceed to the next step which is consistency tests.
    </p>

</section>

<section>
    <h2>Consistency Tests</h2>
    <p>
        Before we unblind, we'll perform the same consistency tests (i.e. jackknives) on the real data as we do for our standard <i><b>r</b></i> analysis, with a particular focus on EB.
        So far, I've been skipping the creation of the standard jacks when making sims to save time, but now I'm going back and rerunning them.
        </p>

    <p>
        We will also conduct an additional consistency test (called a &Delta;&alpha; test) where we split the data based on measured detector polarization angles, and compare the differences in the resulting output angles between data subsets. This will help boost our confidence in the RPS-derived angles (see the draft posting <a href="JAC2023g"></a>). As with our normal jacks, we can calculate &chi; and &chi;<sup>2</sup> metrics


    \begin{align}
    &\chi = \frac{(\Delta\alpha_{real}-\Delta\bar{\alpha}_{sims})}{\sigma_{tot}}\\
    \end{align}

    where &sigma;<sub>tot</sub> in this case still uses &sigma;<sub>CMB,sys</sub>, &sigma;<sub>INST,stat</sub>, and &sigma;<sub>INST,sys</sub>, but gets &sigma;<sub>CMB,stat</sub> from the jack sims.

    </p>
    <p>
        It should be trivial to apply the &Delta;&alpha; test to regular jacks -- fitting an &alpha; to jack EB and making sure that it is consistent with sims -- so we plan on doing that as well.
   </p>

    <p>
        We'll first validate these tests on fake data (i.e. a sim realization in lieu of real) before actually conducting them on real data.
        As with our main analysis, our passing requirement on &chi; and &chi;<sup>2</sup> will be 0.01 < &chi;<sup>(2)</sup> < 0.99 and any failures will require investigation/resolution before moving forward.
    </p>

</section>

<section>
    <h2>Birefringence Results</h2>
    <p>
        Finally, after finalizing the error budget and having the real data pass all consistency tests, we can look at our final science results.
    </p>
    <p>
        Our constraint should take the form of a single number with error bars but there are multiple ways to go about getting that number and we've decided on two in order to have some cross checks.
    </p>

    <ul>
        <li><b>Legacy Result (Sernum 6606):</b> Using the BICEP3 dataset as it was used in BK18 (but without the EB-nulling, obviously). Sims are created to reflect this configuration by using RPS-derived pol angles to create the sim TOD's but using ideal angles to create the maps.</li>
        <li><b>Reanalysis Result (Sernum 6621):</b> Reanalysing the real data using RPS-derived polarization angles to make maps. In contrast to the Legacy Result, sims will use RPS-derived angles in both TOD- and mapmaking.
            Creating sim TOD's with the RPS-derived angles and then creating both real and sim maps with the RPS-derived polarization angles.</li>
    </ul>

    <p>
        These two parallel approaches are intended to be cross-checks of one another, but if we've done everything right then either approach should spit out the same number for our birefringence constraint.
</p>
    <p>
        In either case, we expect that the angle going into TOD-making (&alpha;<sub>TOD</sub>) will be the same for both the sims and real data and likewise for the angle the goes into map-making (&alpha;<sub>MAP</sub>). That way, the excess angle resulting from cosmic birefringence, $\beta$ (in keeping with the naming convention in the literature), is just the difference between the angle fit from the real spectra, $\alpha_{real}$, and the mean angle from the sims, $\bar{\alpha}_{sims}$.
    </p>

    \begin{equation}
    \begin{split}
    \alpha_{sims} &= \alpha_{TOD}-\alpha_{MAP}\\
    &\\
    \alpha_{real} &= \alpha_{TOD}-\alpha_{MAP}+\beta\\
    &\\
    \beta &= \alpha_{real}-\bar{\alpha}_{sims}\\
    \end{split}
    \end{equation}

    <p>We plan on presenting constraints with angles fit to Type 8 (L-LCDM+Noise+Dust) EB spectra both using our typical 9 bandpowers along with an additional 5 (bins 11-15) which should also provide another level of consistency. As of this posting, we intend to report all four results (2 approaches, 2 &ell;-ranges) in a table in the paper, but have <b>our official results be from the "Reanalysis" fitting to all 14 bins</b>. To use the higher bins will require a confirmation that the beam uncertainties are sufficiently small, but we're currently working on that.
    </p>

    <h3>Unblinding Plots</h3>

    <p>The following plots are what we'll be looking at when we officially unblind -- we're currently substituting the spectra from realization 1 from the sims in lieu of using the real data. Both of the approaches above will each have a set of their own plots. Right now I'm only showing the plots from "Legacy" as the sims for "Reanalysis" still need to be completed.</p>
    <p>
        Before we even look at angles, we'll of course look first at the spectra as we normally do for our <b><i>r</i></b> analysis in order to ensure nothing obviously crazy is happening.
        The pager below shows the plots found in our typical final pagers with two major differences.
        <ol>
    <li>We use Type 8 (L-LCDM+Noise+Dust) sims instead of Type 7's (L-LCDM+Noise)</li>
    <li>The real data won't be debiased since we only care about EB.</li>
</ol>
    </p>



    <figure>
        <img alt="Name pager" id="finalpager" src="#" width="50%"/>
        <figcaption>
            Example "Final Pager" for the "Legacy" sims. To remain blinded, all "real" data are just realization 1 from the sims.
        </figcaption>
        <script type="text/javascript">
            function fcn(params){
                return 'figs/'+params.val+'_6606_gh_bins_2_'+params.bins+'.png';
            }

            pager.link("#finalpager",
                {
                    'Figure|val' : ['spectra','chi2','BP Dev|bpdev','Sum BP Dev|bphist'],
                    'N Bins|bins' : ['9|10','14|15'],
                    'Jack|jack' : ['0'],
                },
                fcn);
            pager.setparams({
                'val' : 'spectra',
                'bins': '10',
                'jack' : '0',
            });
        </script>
    </figure>

    <p>    Below is the legend for each of the plots.</p>
    <b>spectra</b>

    <ul>
        <li><span style="color:gray;">thin gray</span> :
            s+n+d simulations with ΛCDM lensed scalars as signal (sim type 8)</li>
        <li><span style="color:gray; font-weight:bold;">thick gray</span> :
            mean of sims (<span style="color:gray;">thin gray</span>)</li>
        <li><span style="color:red;">red points</span> with <span
                style="color:blue;">blue error bars</span> :
            real data, uncertainties from the spread of the s+n
            sims (<span style="color:gray;">thin gray</span>)</li>
    </ul>

    <b>bp devs</b>
    <ul>
        <li><span style="color:gray;">thin gray</span> :
            s+n sims</li>
        <li><span style="color:red;">thin red</span> :
            1 sigma contours</li>
        <li><span style="color:green;">thin green</span> :
            2 sigma contours</li>
        <li><span style="font-weight:bold;">thick black + markers</span> :
            real data</li>
        <li><span style="color:red;">red markers</span> :
            bins that go into chi2 analysis</li>
    </ul>

    <p>Note: The contours mark the simulated bandpower in each bin closest
        to the respective percentile.</p>

    <b>chi2</b>
    <ul>
        <li><span style="color:red;">red vertical</span> :
            real data</li>
        <li><span style="color:blue;">blue</span> :
            distribution from s+n sims</li>
    </ul>

    <b>sum bp devs</b>
    <ul>
        <li><span style="color:red;">red vertical</span> :
            real data</li>
        <li><span style="color:blue;">blue</span> :
            distribution from s+n sims</li>
    </ul>


<hr>


    <p>
        Next, we'll actually look at the histograms of &beta; for fitting to both bin-ranges.
        To give a clear visual indication of a detection, I've included some dotted vertical lines which will represent the N-sigma detection threshold (more on that in &sect;3.2) calculated from N times the total uncertainty, &sigma;<sub>&beta;</sub>, as defined in section 1.

    </p>
        <p>The standard deviation of the histograms gives us &sigma;<sub>CMB,stat</sub>, but  we still need to finalize the systematic uncertainty from the CMB analysis (&sigma;<sub>CMB,sys</sub> from alternate dust models and beams mostly), and the stat/sys uncertainties from the instrumental calibration.
    </p>


    <figure>
        <img src="figs\unblinded_hists_6606_test.png">
        <figcaption>
            Histograms of &beta; for "Legacy". The blue bars are the sims and the green line is the real data (rlz 1 of the sims here). The black dotted lines will show the 2&sigma; error bars from the total uncertainty.
        </figcaption>
    </figure>

    <p>Finally, I'll also include a table summarizing &beta; and the final statistical and systematic uncertainties.</p>

    <figure class="table">
        <table class="results">
            <tr>
                <th colspan="7"></th>
            </tr>
            <tr>
                <th colspan="2"></th>
                <th colspan="2">&sigma;<sub>CMB</sub></th>
                <th colspan="2">&sigma;<sub>INST</sub></th>
                <th colspan="2"></th>
            </tr>

            <tr>
                <th>Approach</th>
                <th class="cstart">&beta;</th>
                <th class="cstart">stat</th>
                <th>sys</th>
                <th class="cstart">stat</th>
                <th>sys</th>
                <th class="cstart">Significance (&sigma;)</th>
            </tr>
            <tr>
                <td>Legacy, 9BP</td>
                <td class="cstart">0.05</td>
                <td class="cstart">0.11</td>
                <td>--</td>
                <td class="cstart">--</td>
                <td>--</td>
                <td class="cstart">0.5</td>
            </tr>
            <tr>
                <td>Legacy, 14BP</td>
                <td class="cstart">0.04</td>
                <td class="cstart">0.08</td>
                <td>--</td>
                <td class="cstart">--</td>
                <td>--</td>
                <td class="cstart">0.6</td>
            </tr>
            <tr>
                <td>Reanalysis, 9BP</td>
                <td class="cstart">--</td>
                <td class="cstart">--</td>
                <td>--</td>
                <td class="cstart">--</td>
                <td>--</td>
                <td class="cstart">--</td>
            </tr>
            <tr>
                <td>Reanalysis, 14BP</td>
                <td class="cstart">--</td>
                <td class="cstart">--</td>
                <td>--</td>
                <td class="cstart">--</td>
                <td>--</td>
                <td class="cstart">--</td>
            </tr>
        </table>
<figcaption>
Table of results, final uncertainties, and detection significance (using fake data for now).
</figcaption>
    </figure>

   <h3>Detection Criteria and Consequences</h3>
    <h4>What constitutes a detection?</h4>
    <p>I'd like to establish a detection threshold of 2&sigma;, i.e. our constraint will be consistent with the null hypothesis if it satisfies:</p>

    \begin{equation}
    \label{eq:sigthresh}
    \frac{|\beta|}{\sigma_{tot}} \le 2
    \end{equation}

<p>
    I chose 2&sigma; specifically because I've done a majority of this analysis by myself. I am confident in my abilities to say that the chances I've seriously messed up something in the analysis is realistically probably no worse than one in 20, but not necessarily as good as one in 100 (i.e. 2.5&sigma;).
</p>

    <p>If our value of &beta; satisfies Eq. \ref{eq:sigthresh}, then we will finish the paper establishing some nice bounds on isotropic birefringence.</p>


    <h4>What happens if we've detected something?</h4>
    <p>One could pose the argument that if we are confident enough to publish a &beta;=0 constraint, then we should be confident enough to publish a &beta;&ne;0 constraint.
        The major counterpoint to this argument is that we (James and Clara) have been solely responsible for the entirety of this very complicated analysis.
        While we have no reason to believe that &beta;=0 would be a result from some systematics we might've missed, a significant detection of non-zero &beta; on the other hand would imply that we've discovered some brand new physics.
        That, at the very least, should warrant some other eyes on all of the little details that went into the result.
    </p>
<p>
    That said, we propose that if &beta;&ne;0 to greater than the 2&sigma; threshold, then we pause releasing the paper until we can do at least A and possibly B and/or C:
    <ol type="A">
    <li>Have other people independently go through the entire analysis</li>
    <li>Include more CMB data (up to 2022)</li>
    <li>Get another RPS observation as an independent cross check</li>
     <ul>
         <li>Hardware/Software upgrades</li>
         <li>Repeat of the same RPS observations on B3</li>
         <li>B3 near-field observations with RPS on DSL mast</li>
         <li>RPS Observations on other receivers</li>
     </ul>
    </ol>
</p>

    <p>
        An obvious question that might be asked is "then why don't we just wait to unblind and do those things first?". The answer to that is fairly simple: our collaboration has a high standard of quality for publishing but finite person-power to conduct various analyses.
        The proposal described above, we think, is a fair compromise on those two facts -- allowing us to complete the analysis while adhering to that high standard and dedicating more resources when something truly unexpected (like new physics) shows up in the data.
        </p>



</section>
<section>
    <h2>Summary</h2>
<p>Below is a summary of the steps we will take between this posting and the posting that will contain our results:</p>
    <ol>
        <li>
            <b>Resolve remaining questions and form final uncertainties.</b>
        </li>

        <ol>
            <li>Instrumental Calibration</li>
            <ol>
                <li>Independent cross checks on absolute RPS angle.</li>
                <li>Uncertainty coming from the pointing model.</li>
                <li>Compute total &sigma;<sub>INST,stat</sub>/&sigma;<sub>INST,sys</sub>.</li>
            </ol>
            <li>CMB Analysis</li>
            <ol>
                <li>&sigma;<sub>CMB,sys</sub> contribution from beam systematics.</li>
                <li>Make sure we've got the sign of &beta; (i.e. the B in EB) correct.</li>
            </ol>
            </ol>
        <li>
            <b>Complete all of the consistency tests.</b>
        </li>

        <ol>
            <li>Check the tests using a sim realization in lieu of real data.</li>
            <li>Regular jacks pass spectral null tests.</li>
            <li>Regular jacks pass &Delta;&alpha; null tests.</li>
            <li>Angle subset jack passes spectra test.</li>
            <li>Angle subset jack passes &Delta;&alpha; test.</li>
            <li>Complete tests on real data.</li>
        </ol>
        <li>
            <b>Unblind to birefringence angle from "Legacy" and "Reanalysis" data simultanously.</b>
        </li>
        <ol>
            <li>If results are consistent with &beta;=0 within 2&sigma; then we publish constraints.</li>
            <li>If not, we'll double check the analysis and/or include additional data before publishing.</li>
        </ol>
    </ol>

</section>

<hr>

<section class="appendix">
<h2 class="appendix">Appendix</h2>
    <h3>Footnotes</h3>
    <p>Click on the number to return to the main text.</p>
    <div class="footnote">
        <p>
        <sup><a name="ftn1" href="#sup1">[1]</a></sup>
    </p>
    </div>

    <!--
    <h3>Code</h3>
    <p>Below is a list of code that was used for this analysis. The code is committed to the pipeline and can be found in the <tt>analysis/beammap/</tt> directory.</p>
    <p id="code"></p>

    <p id="testp"></p>

    <script type="text/javascript">

        // Shorthand tags
        var codes = [
            "rps_fit_mirror_from_moon.m",
            ];

        // Posting titles
        var desc = [
            "Derives mirror parameters from observations of the moon.",
        ];

        // Make a list of references
        var post = document.getElementById("code");
        var msg = "<table class=\"code\">";
        for (var code in codes){
            msg = msg + "<tr><td><tt>"+codes[code]+"</tt></td><td> - </td><td>"+desc[code]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

    </script>


    <h3>Data</h3>
    <p id="data"></p>



    <script type="text/javascript">

        // Shorthand tags
        var data = [
            "moonsch.mat",
            ];

        // Posting titles
        var desc = [
            "Metadata of Moon observations",
            ];

        // Make a list of references
        var post = document.getElementById("data");
        var msg = "<table class=\"code\">";
        for (var datum in data) {
            msg = msg + "<tr><td><tt>" + data[datum] + "</tt></td><td> - </td><td>" + desc[datum] + "</td>";
        }
        ;
        msg = msg + "</table>";
        post.innerHTML = msg;

    </script>
-->


    <h3>References</h3>

    <p id="references"></p>


    <script type="text/javascript">

        // This my way of making shorthand links.
        // We'll make a couple arrays with the 'tag' and href information
        // and then look through each anchor element for the specified tag.
        // The anchors should then just look like: <a href="tagname"></a>
        // and the script will automatically fill in the hyperlings and text.


        var posting_dir = window.location.href; // What's the current url?

        var bkurl = "bicep.rc.fas.harvard.edu";
        var spurl = "bicep.usap.gov";

        // These are the possible places to find postings
        // The strings are for if you post your posting in that directory.
        var sitemap = {
            jcornelison: "../../../",   // /jcornelison/postings/
            cverges: "../../",          // cverges/
            bkcmb : "../../../../",     // /bkcmb/analysis_logbook/analysis/
            bicep3: "../../../",        //
            bicep_array: "../../../",   //
            bicep2: "",                 // We shouldn't be posting in these, but still have postings we can reference.
            keck  : "",                 // keck/analysis_logbook/analysis/
            spuder: "",                 // ~spuder/hieno_analysis_logboo
            bicep1: "",                 // ~bicep1/analysis_logbook_north/
            general_projects:"",
                   };
        // Logbook Site map:
        // personal:www/jcornelison/postings/
        // bkcmb:   www/bkcmb/analysis_logbook/analysis/
        // keck:    www/keck/analysis_logbook/analysis/
        // BICEP3:  www/bicep3/analysis_logbook/
        // BA:      www/bicep_array/analysis_logbook/
        // We shouldn't be posting in these, but still have postings.
        // bicep2:
        // keck:    www/keck/analysis_logbook/analysis/
        // spuder:  www/~spuder/hieno_analysis_logbook/
        // bicep1:  www/~bicep1/analysis_logbook_north/

        // Shorthand tags
        var tags = [
            "JAC2023a",
            "JAC2023b",
            "JAC2023c",
            "JAC2023d",
            "JAC2023e",
            "JAC2023f",
            "CV2023a",
            "JAC2023g",
            "CV2023b",
            "JAC2023h",
            "JAC2023i",
            "IPRpaper",
        ];

        // Links
        // Truncate the link down to the www directory in which it lies if you can.
        // This ensures that we can view the linked postings at Pole without the internet.
        var hrefs = [
            "bkcmb/analysis_logbook/analysis/20230207_IPR_angle_fits_to_B2018/",
            "bkcmb/analysis_logbook/analysis/20230214_IPR_B18_mat_pure/",
            "bkcmb/analysis_logbook/analysis/20230214_IPR_pol_rot_sims/",
            "bkcmb/analysis_logbook/analysis/20230328_IPR_high_ell/",
            "bkcmb/analysis_logbook/analysis/20230328_IPR_forecasting/",
            "jcornelison/postings/20230321_IPR_B18_subsets/",
            "cverges/20221215_alt_dust_sim/",
            "jcornelison/postings/2023mmdd_IPR_det_subset_jacks/",
            "cverges/20230428_EB_bmsims/",
            "jcornelison/postings/2023mmdd_isaac_data/",
            "jcornelison/postings/2022mmdd_rps_pointing/",
            "https://www.overleaf.com/read/pnnzqscqtpsn",
        ];


        // Posting titles
        var desc = [
            "Isotropic Polarization Rotation Analysis: Global Polarization Rotation Fits on Standard B2018 Sims",
            "Isotropic Polarization Rotation Analysis 2: B18 sims and combined EB+TB fits",
            "Isotropic Polarization Rotation Analysis 3: B2018 Polarization Rotation sims",
            "Isotropic Polarization Rotation Analysis 4: Angle estimates including higher ell-bins",
            "Isotropic Polarization Rotation Analysis 5: Basic Forecasting of Angle Uncertainty on B18 sims",
            "Isotropic Polarization Rotation Analysis 6: Angle Fits With Reduced Coverage in B18 sims",
            "Isotropic Polarisation Rotation Analysis 7: Alternate dust models",
            "Isotropic Polarization Rotation Analysis: An RPS Angle Subset Jack(draft)",
            "Isotropic Polarization Rotation Analysis: T&rightarrow;P leakage systematics(draft)",
            "Summary of RPS Angle Cross Checks with the ISAAC(draft)",
            "2022 RPS Analysis: Observations and Pointing Systematics(draft)",
            "IPR Analysis Paper",
        ];
        // Debug
        var posty = document.getElementById("testp");


        var preface = "";
        var keys = Object.keys(sitemap);
        // If we're not at pole or bicep, just post the full URL
        // If we are, go back to the www directory.
        if (posting_dir.match(new RegExp(bkurl))!=bkurl &
            posting_dir.match(new RegExp(spurl))!=spurl){
                preface = "http://" + bkurl+"/";
            }
        else {
            for (key in keys){
                if (posting_dir.match(new RegExp("/"+keys[key]+"/"))=="/"+keys[key]+"/"){
                    preface = sitemap[keys[key]];
                };
            };

        };

        // Add the prefixes we can.
        // Only add prefixes to directories in the sitemap so we don't break
        // external references.
        for (ref in hrefs) {
            for (key in keys) {

            // If there's a match, at the prefix and move on.
            if(hrefs[ref].match(new RegExp(keys[key] + "/"))==keys[key]+"/"){
                hrefs[ref] = preface+hrefs[ref];
                break;
            }
            };
        };

        // posty.innerHTML = preface;

        // Make a list of references
        var post = document.getElementById("references");
        var msg = "<table>";
        for (var tag in tags){
            msg = msg + "<tr><td><a href="+tags[tag]+"></a></td><td> - </td><td>"+desc[tag]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

        // Look through all the hyperlinks and insert the proper links to the postings
        var links = document.getElementsByTagName("A");
        for (var link in links){
            for (var tag in tags){
                if (links[link].href.endsWith(tags[tag])){
                    links[link].text = "("+tags[tag]+")";
                    links[link].href = hrefs[tag];
                    links[link].target = "_blank";
                }
            }
        }

    </script>
</section>
</body>
