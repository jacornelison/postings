<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Scratch — J. Cornelison</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Load up MathJax for math notation -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            TeX: { equationNumbers: { autoNumber: "AMS" } }
        });
    </script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
              tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript"
            src="../mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

</head>

<body>
<!-- Add my custom pager script -->
<script type="text/javascript" src="scripts/pager.js"></script>
<link rel="stylesheet" type="text/css" href="scripts/pager.css">

<header>
    <h1>Tilt Meter Systematics</h1>

    <time datetime="2020-xx-xx" class="published updated">
        YYYY MMM DD
    </time> —
    J. Cornelison
</header>

<hr>

<!--
- What are you doing?
- Why are you doing it?
- Who's your audience? Why should they care?
- Can you boil this down to the most important parts?

-->

<!--
<section>



    <figure class="table">
        <table class="center results">

            <tr>
                <th colspan="4">Beam Centers</th>
            </tr>
            <tr>
                <th>Parameter</th>
                <th>Uncertainty</th>
                <th>Bias $\phi_{pair}\,(^o)$</th>
                <th>Reference</th>
            </tr>
            <tr>
                <td></td>
                <td>$10\%$</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>Ground Reflections</td>
                <td>-25 dB</td>
                <td>$<<0.01$</td>
                <td><a href="RPR"></a> &sect; 5.2</td>
            </tr>
            <tr>
                <td>Mirror Deformations</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>Mast Swaying</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <th colspan="4">Mirror / Source Estimation</th>
            </tr>
            <tr>
                <th>Parameter</th>
                <th>Uncertainty (m)</th>
                <th>Bias $\phi_{pair}$</th>
                <th>Reference</th>
            </tr>
            <tr>
                <td>Starpointing</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>Tilt Origins</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>CMB-derived pointing</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>Mast Position Repeatability</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>Diurnal Mirror Heating</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <th colspan="4">Polarization Angle</th>
            </tr>
            <tr>
                <th>Parameter</th>
                <th>Uncertainty (m)</th>
                <th>Bias $\phi_{pair}$</th>
                <th>Reference</th>
            </tr>
            <tr>
                <td>Wire Grid Horizontal</td>
                <td>$0.01^o$</td>
                <td>0.01</td>
                <td>-</td>
            </tr>
            <tr>
                <td>RPS Tiltmeter (Relative)</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>RPS Tiltmeter (Absolute)</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>RPS output stability</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>RPS Collimation</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>RPS Pointing / Beam Shape</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>Mirror differential polarization reflection</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <td>DK-dependent Variation</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
            </tr>
            <tr>
                <th colspan="4"></th>
            </tr>
            <tr>
                <th>Total</th>
                <th></th>
                <th>-</th>
                <th></th>
            </tr>

        </table>

        <figcaption>
            Table of possible sources of systematics and their propagated errors.
        </figcaption>
    </figure>


</section>


<section>
<h2></h2>

    <figure class="table">
        <table class="center results">

            <tr>
                <th colspan="4">Solidworks</th>
            </tr>
            <tr>
                <th>Parameter</th>
                <th>Uncertainty (m)</th>
                <th>Bias Tilt (&deg;)</th>
                <th>Bias Roll (&deg;)</th>
            </tr>
            <tr>
                <td>Aperture Height</td>
                <td>$0.0100$</td>
                <td>$^{0.0000}_{0.0000}$</td>
                <td>$^{0.0001}_{0.0001}$</td>
            </tr>
            <tr>
                <td>Mirror Height</td>
                <td>$0.1000$</td>
                <td>$^{0.0000}_{0.0000}$</td>
                <td>$^{0.0001}_{0.0001}$</td>
            </tr>
            <tr>
                <th colspan="4">Star Pointing</th>
            </tr>
            <tr>
                <th>Parameter</th>
                <th>$2\sigma$ Stat. Uncert. (&deg;)</th>
                <th>Bias Tilt (&deg;)</th>
                <th>Bias Roll (&deg;)</th>
            </tr>
            <tr>
                <td>flex_cos</td>
                <td>$0.0000$</td>
                <td>$^{NaN}_{NaN}$</td>
                <td>$^{NaN}_{NaN}$</td>
            </tr>
            <tr>
                <td>flex_sin</td>
                <td>$0.0000$</td>
                <td>$^{NaN}_{NaN}$</td>
                <td>$^{NaN}_{NaN}$</td>
            </tr>
            <tr>
                <td>az_tilt_ha</td>
                <td>$0.0015$</td>
                <td>$^{0.0003}_{-0.0003}$</td>
                <td>$^{0.0037}_{-0.0037}$</td>
            </tr>
            <tr>
                <td>az_tilt_lat</td>
                <td>$0.0015$</td>
                <td>$^{0.0007}_{-0.0007}$</td>
                <td>$^{-0.0014}_{0.0015}$</td>
            </tr>
            <tr>
                <td>el_tilt</td>
                <td>$0.0082$</td>
                <td>$^{0.0001}_{-0.0001}$</td>
                <td>$^{0.0223}_{-0.0223}$</td>
            </tr>
            <tr>
                <td>collim_x</td>
                <td>$0.0000$</td>
                <td>$^{NaN}_{NaN}$</td>
                <td>$^{NaN}_{NaN}$</td>
            </tr>
            <tr>
                <td>collim_y</td>
                <td>$0.0000$</td>
                <td>$^{NaN}_{NaN}$</td>
                <td>$^{NaN}_{NaN}$</td>
            </tr>
            <tr>
                <td>collim_mag</td>
                <td>$0.0012$</td>
                <td>$^{0.0000}_{0.0000}$</td>
                <td>$^{0.0000}_{0.0000}$</td>
            </tr>
            <tr>
                <td>collim_dir</td>
                <td>$0.1279$</td>
                <td>$^{0.0000}_{0.0000}$</td>
                <td>$^{0.0000}_{0.0000}$</td>
            </tr>
            <tr>
                <td>az_zero</td>
                <td>$0.0145$</td>
                <td>$^{0.0001}_{-0.0001}$</td>
                <td>$^{-0.0097}_{0.0098}$</td>
            </tr>
            <tr>
                <td>el_zero</td>
                <td>$0.0013$</td>
                <td>$^{-0.0007}_{0.0006}$</td>
                <td>$^{0.0000}_{-0.0000}$</td>
            </tr>
            <tr>
                <th>Total</th>
                <th></th>
                <th>$\pm 0.0011$</th>
                <th>$\pm 0.0247$</th>
            </tr>

        </table>

        <figcaption>
            Table of possible sources of systematics and their propagated errors. Errors for the parameters derived from Solidworks models are extremely conservative upper limits. Lastly, uncertainties for starpointing were estimated by bootstrap. Because the number of data points is low $(N_{stars}=32)\,$, I double the uncertainty returned by the bootstrap to use as a conservative estimate.
        </figcaption>
    </figure>

</section>
-->

<section>
    <h2></h2>
    <h3>The Concept</h3>
    <p>Knowledge of the RPS's polarization orientation is essential. We measure the orientation via a precision tilt meter built into the RPS itself. Either we need to actively keep the tilt stable to within some target threshold, or we need to track the tilt at all times so we can account for it during analysis. In previous RPS obs campaigns, the former approach was taken where the tilt was monitored by-eye via multimeter and zeroed at least once daily using the mast guy lines. In 2018, I opted for the latter approach where I performed an initial zeroing of the tilt meter and then digitally recorded the tilt (at 1 sample per second) over the course of the RPS campaign using a LabJack.</p>


    <h3>The Problem</h3>
    <p>The readout of the tilt meter is affected by electrical coupling with the 2-phase/50 pole stepper motor in the rotation stage. Whenever the rotation stage is moved, the tilt readout drops to some consistently lower, noiser value. When the stage completes its motion the tilt reading increases, but there is a chance that the tilt will not return to the previous level before the stage was moved and instead settle at some other value. This looks like a discontinuous step in the tilt readout. Thus, the relative tilt from raster-to-raster is unreliable. Further, because the stage was rotated between when the tilt calibration was completed and when the mast was zeroed, we cannot guarantee the the absolute tilt of the RPS either.</p>

    <figure>
        <img src="figs/tilt_timestream_annotated.png" width="100%">
        <figcaption>

        </figcaption>
    </figure>


    <p>
        Note that when the stage not commanded for extended periods of time (during fridge cycles for instance), no stepping is seen and a diurnal fluctuation in tilt (likely from the sun) can be measured.
    </p>

    <h3>Hypothesis</h3>
    <p>The amplitude of the tilt meter is electrically coupled to the current supplied to the various stators of the rotation stage's stepper motor. As a result, when the stage is stopped, a DC offset can be seen in the tilt which is proportional to the holding current supplied to a particular stator. When the stage is in motion, the coupling amplitude results from an averaging down over all of the possible currents. Thus the value that the tilt goes to when the stage is moving should be consistent from movement to movement.</p>



    <h3>Evidence</h3>
    <p>If the coupling of the amplitude of the stage while in motion is consistent between movements, then we should be able to see the same diurnal fluctuations that can be seen when the RPS is left unmoved for extended periods of time which is confirmed in Fig. ##. </p>

    <figure>
        <img src="figs/tilt_compare_moving_vs_extended_rest.png" width="100%">
        <figcaption>
            The median has been subtract for this plot to account for the DC offset from the rotation stage.
        </figcaption>
    </figure>

    <h3>Pol Angle Relative Calibration</h3>
    <p>At the most pessimistic, we can take the min and max deviation from the moving-stage DC offset and call that the upper limit on the systematic uncertainty of the relative calibration. This comes out to $\pm0.09^o$.</p>

    <h3>Pol Angle Abs Cal</h3>
    Facts:
    <ul>
        <li>I calibrated the tilt at some DC offset
        <li>I levelled at (likely) some other DC offset. What if that was at the opposite end?
        <li>The offset can either positive or negative WRT moving-source DC offset
        <li>The max offset seen is ~0.25deg WRT moving-source offset
    </ul>
    Assumptions:
    <ul>
        <li>DC offset can go equally pos. or neg. WRT moving-source DC offset
        <li>The DC offset when I levelled compared to when I calibrated was the exact opposite of what I calibrated at.</ul>

    Result:
        The systematic error on the abs cal of the tilt meter is $2\times0.25+2\times0.25\,=\,1^o$


    <h3>Upper limit on mast swaying</h3>
    <p>If we assume that the diurnal fluctuations in tilt is from heating of the mast's guy wires, then the source position would also be moving as the mast sways throughout the day. Using the same upper limit from the relative calibration ($\pm0.05^o$) we can calculate the apparent change in Azimuth of the source position:</p>

    $$\sigma_{Az} = \tan^{-1}\left(\frac{H_{mast}\tan\left(\sigma_{tilt}\right)}{D_{src}}\right)$$

    <p>Where $H_{mast}$ is the height of the mast from its pivot point (i.e. just the roof of MAPO) and $D_src$ is the distance from BICEP3 to the source, which are both known to be $H_{mast}=12\text{m}$ and $D_{src}=195.5\text{m}$. This gives us $\sigma_{Az} = \pm0.003^o$ which is currently subdominant to other systematics.</p>


    <h3>Conclusion</h3>
    <p>
        Figure ## confirms that the tilt offset is always the same while the stage is rotating. At the very least, this allows us to acquire an upper limit on the relative fluctuation of source from diurnal heating. Further, we could arguably account for these fluctuations in the timestreams themselves by interpolating between movements.
    </p>

    <p>
        In order to reestablish the absolute calibration of the tilt, we would need ...
    </p>

    <p>
        ... could be a likely cause, but more investigation is needed.
    </p>

    <figure id="tilefig">
        <img alt="pager" id="tilepager" src="#" width="60%"/>
        <figcaption>
            $\theta_{tilt}$: Raw tilt readout averaged over the whole rasterset. $\phi_{pair}$: RPS-derived 'pair-diff' polarization angle with the all-DK average subtracted. $\phi_{0}$: Per detector polarization angles for detectors designed to be close to $\phi=0^o$ (e.g. Pol B's for MCE0 and Pol A's for MCE's 1 thru 3). $\phi_{90}$: Per detector polarization angles for detectors designed to be close to $\phi=90^o$
        </figcaption>
        <script type="text/javascript">
            var tpager = new Pager("tilepager")
            tpager.link("#tilepager",
                {
                    'Plot|p':['$\\theta_{tilt}$|tilt','$\\phi_{pair}$|phiq','$\\phi_0' +
                    '$|phi0','$\\phi_{90}$|phi90','$\\sigma_{tilt}$|tiltstd'],
                    'DK|k':['0','90','45','135','45_2'],
                    'Cuts|c':['None|','tilt std<0.05|_cut']
                },
                function(params) {
                    return 'figs/tileplot_dk_'+params.k+'_'+params.p+params.c+'.png';
                });
            tpager.setparams({
                'p':'tilt',
                'k': '0',
                'c': '_cut',

            });
        </script>
    </figure>

    <figure>
        <img src="figs/scatterplot_alldk.png" width="50%"/>
        <figcaption>
            Scatter plots of $\phi_{pair}$ vs $\theta_{tilt}$ for each DK-observation.
        </figcaption>
    </figure>


</section>
<!--
<section>
<h3>Comparing tilt during Fridge Cycles to RPS schedules</h3>


    <figure>
        <img src="figs/tilt_timestream_compare.png" width="100%"/>
        <figcaption>
(Top) Tilt readout with the per-day median subtracted for fridge cycles and FFBM observations as a function of time-of-day (UTC). (Middle-top) Raw tilt readout during RPS schedules. (Middle bottom) Naive destepped tilt readout for RPS schedules. (Bottom) Destepped tilt temperature during RPS schedules.
        </figcaption>
    </figure>


    <figure>
        <img src="figs/tilt_timestream_compare_with_pol.png" width="100%"/>
        <figcaption>

        </figcaption>
    </figure>



</section>

<section>


    <figure>
        <img alt="pager" id="scanpager" src="#" width="100%"/>
        <figcaption>
            Raw timestreams of the tilt meter in the RPS. Observations 1 to 3 correspond to DK=0; 4 to 6 at DK=90; 7 to 9 at DK=45; 10 to 12 at DK=135; and 13 to 14 at DK=45.
        </figcaption>
        <script type="text/javascript">
            pager.link("#scanpager",
                {
                    //'Plot|p':['Raw|','Destepped|_corr'],
                    'DK|k':['0','90','45','135','45_2'],
                    'Azoff|a':['-13','-4','4'],

                },
                function(params) {
                    return 'figs/tilt_monitor_dk_'+params.k+'_azoffs_'+params.a+'.png';//params.p+'.png';
                });
            pager.setparams({
                'p':'',
                'k': '90',
                'a':'-13'
            });
        </script>
    </figure>



</section>
-->
<!--    <h3>Code</h3>-->
<!--    <p>Below is a list of code that was used for this analysis. The entries under <tt>pipeline code</tt> is committed to the pipeline and can be found in the designated directories. Those under <tt>posting code</tt> can be found in the <tt>scripts/</tt> directory of this posting.</p>-->
<!--    <p id="code"></p>-->


    <h3>References</h3>

    <p id="references"></p>

<!--    <p id="testp"></p>-->

<!--    <script type="text/javascript">-->

<!--        // Code name-->
<!--        var codes = [-->
<!--            "\<b\>Pipeline Code\</b\>",-->
<!--            "util/encoder_to_raw_mount_coords.m",-->
<!--            "util/beam_map_pointing_model.m",-->
<!--            "\<b\>Posting Code\</b\>",-->
<!--            "sim_scan.m",-->
<!--            "ipm_check.m",-->
<!--            "reckon_check.m",-->
<!--            "kbmp_check.m",-->
<!--            "example_load_and_plot",-->
<!--            ];-->

<!--        // Short Code description-->
<!--        var desc = [-->
<!--            "",-->
<!--            "Converts raw encoder values from GCP arcfiles to Raw Mount Coordinates $(A_0,E_0,K_0)$.",-->
<!--            "Converts Raw Mount Coordinates to inst.-fixed coords.",-->
<!--            "",-->
<!--            "Makes example az/el/dk scans and runs them through the pointing models.",-->
<!--            "Compares BMPM outputs to IPM for Fig. 1.3.",-->
<!--            "Compares BMPM outputs to reckon for Fig. 1.4.",-->
<!--            "Compares BMPM outputs to KBMP for Fig. 1.5.",-->
<!--            "Example code to load real data and apply the pointing model.",-->
<!--        ];-->

<!--        // Make a list of references-->
<!--        var post = document.getElementById("code");-->
<!--        var msg = "<table class=\"code\">";-->
<!--        for (var code in codes){-->
<!--            msg = msg + "<tr><td><tt>"+codes[code]+"</tt></td><td> - </td><td>"+desc[code]+"</td>";-->
<!--        };-->
<!--        msg = msg+ "</table>";-->
<!--        post.innerHTML = msg;-->

<!--    </script>-->


    <script type="text/javascript">

        // This my way of making shorthand links.
        // We'll make a couple arrays with the 'tag' and href information
        // and then look through each anchor element for the specified tag.
        // The anchors should then just look like: <a href="tagname"></a>
        // and the script will automatically fill in the hyperlings and text.


        var posting_dir = window.location.href; // What's the current url?

        var bkurl = "bicep.rc.fas.harvard.edu";
        var spurl = "bicep.usap.gov";

        // These are the possible places to find postings
        // The strings are for if you post your posting in that directory.
        var sitemap = {
            jcornelison: "../../../",   // /jcornelison/postings/
            bkcmb : "../../../../",     // /bkcmb/analysis_logbook/analysis/
            bicep3: "../../../",        //
            bicep_array: "../../../",   //
            bicep2: "",                 // We shouldn't be posting in these, but still have postings.
            keck  : "",                 // keck/analysis_logbook/analysis/
            spuder: "",                 // ~spuder/hieno_analysis_logboo
            bicep: "",                 // ~bicep/analysis_logbook_north/
                   };
        // Logbook Site map:
        // personal:www/jcornelison/postings/
        // bkcmb:   www/bkcmb/analysis_logbook/analysis/
        // keck:    www/keck/analysis_logbook/analysis/
        // BICEP3:  www/bicep3/analysis_logbook/
        // BA:      www/bicep_array/analysis_logbook/
        // We shouldn't be posting in these, but still have postings.
        // bicep2:
        // keck:    www/keck/analysis_logbook/analysis/
        // spuder:  www/~spuder/hieno_analysis_logbook/
        // bicep1:  www/~bicep1/analysis_logbook_north/

        // Shorthand tags
        var tags = [
            "RPR",
            "SPIE2020",
            ];

        // Links
        // Truncate the link down to the www directory in which is lies if you can.
        var hrefs = [
            "https://drive.google.com/file/d/1gENnPU4MOMHUUR0Obk87jwCdb37JmVUb/view",
            "https://arxiv.org/pdf/2012.05934.pdf",
        ];


        // Posting titles
        var desc = [
            "Cornelison Research Project Report",
            "Cornelison SPIE 2020 Proceedings",
        ];
        // Debug
        var posty = document.getElementById("testp");


        var preface = "";
        var keys = Object.keys(sitemap);
        // If we're not at pole or bicep, just post the full URL
        // If we are, go back to the www directory.
        if (posting_dir.match(new RegExp(bkurl))!=bkurl &
            posting_dir.match(new RegExp(spurl))!=spurl){
                preface = "http://" + bkurl+"/";
            }
        else {
            for (key in keys){
                if (posting_dir.match(new RegExp("/"+keys[key]+"/"))=="/"+keys[key]+"/"){
                    preface = sitemap[keys[key]];
                };
            };

        };

        // Add the prefixes we can.
        // Only add prefixes to directories in the sitemap so we don't break
        // external references.
        for (ref in hrefs) {
            for (key in keys) {

            // If there's a match, at the prefix and move on.
            if(hrefs[ref].match(new RegExp(keys[key] + "/"))==keys[key]+"/"){
                hrefs[ref] = preface+hrefs[ref];
                break;
            }
            };
        };

        // posty.innerHTML = preface;

        // Make a list of references
        var post = document.getElementById("references");
        var msg = "<table>";
        for (var tag in tags){
            msg = msg + "<tr><td><a href="+tags[tag]+"></a></td><td> - </td><td>"+desc[tag]+"</td>";
        };
        msg = msg+ "</table>";
        post.innerHTML = msg;

        // Look through all the hyperlinks and insert the proper links to the postings
        var links = document.getElementsByTagName("A");
        for (var link in links){
            for (var tag in tags){
                if (links[link].href.endsWith(tags[tag])){
                    links[link].text = "("+tags[tag]+")";
                    links[link].href = hrefs[tag];
                    links[link].target = "_blank";
                }
            }
        }

    </script>
</section>
</body>
